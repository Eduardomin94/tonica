"use client";
import React, { useMemo, useState } from "react";
import { Inter } from "next/font/google";

const inter = Inter({
  subsets: ["latin"],
  weight: ["400", "500", "600", "700", "800"],
});

/* ================== CONSTANTES ================== */

const CATEGORIES = [
  { value: "top", labelKey: "catTop" },
  { value: "outerwear", labelKey: "catOuterwear" },
  { value: "bottom", labelKey: "catBottom" },
  { value: "dress", labelKey: "catDress" },
  { value: "set", labelKey: "catSet" },
  { value: "swim", labelKey: "catSwim" },
  { value: "body", labelKey: "catBody" },
  { value: "other", labelKey: "catOther" },
] as const;

const MODEL_TYPES = [
  { value: "newborn", labelKey: "modelNewborn" },
  { value: "boy", labelKey: "modelBoy" },
  { value: "girl", labelKey: "modelGirl" },
  { value: "man", labelKey: "modelMan" },
  { value: "woman", labelKey: "modelWoman" },
] as const;

const ETHNICITIES = [
  { value: "caucasian", labelKey: "ethCaucasian" },
  { value: "latino", labelKey: "ethLatino" },
  { value: "asian", labelKey: "ethAsian" },
  { value: "black", labelKey: "ethBlack" },
  { value: "mediterranean", labelKey: "ethMediterranean" },
] as const;

const POSES = [
  { value: "sitting", labelKey: "poseSitting" },
  { value: "standing", labelKey: "poseStanding" },
  { value: "walking", labelKey: "poseWalking" },
] as const;

const BODY_TYPES = [
  { value: "standard", labelKey: "bodyStandard" },
  { value: "plus", labelKey: "bodyPlus" },
] as const;

function wordCount(s: string) {
  return s.trim().split(/\s+/).filter(Boolean).length;
}

if (typeof document !== "undefined") {
  const style = document.createElement("style");
  style.innerHTML = `
    @keyframes whatsappPulse {
      0% { box-shadow: 0 0 0 0 rgba(37,211,102,0.6); }
      70% { box-shadow: 0 0 0 18px rgba(37,211,102,0); }
      100% { box-shadow: 0 0 0 0 rgba(37,211,102,0); }
    }
  `;
  document.head.appendChild(style);
}


/* ================== APP ================== */
export default function Home() {
  const [language, setLanguage] = useState<"es" | "en" | "pt" | "ko" | "zh">("es");
  const t = (key: any, ...args: any[]) => {
  const dict = (translations as any)[language] || {};
  const en = (translations as any).en || {};
  const es = (translations as any).es || {};

  const val = dict?.[key] ?? en?.[key] ?? es?.[key];
  if (typeof val === "function") return val(...args);
  return String(val ?? key);
};

function appendProductFormData(fd: FormData) {
  productFiles.forEach((f) => fd.append("product_images", f));
  fd.append("scene", scene.trim());
}

function appendModelFormData(fd: FormData) {
  // âœ… NOMBRES DE ARCHIVOS (multer suele esperar estos)
  if (frontFile) fd.append("front", frontFile);
  if (backFile) fd.append("back", backFile);
  if (faceFile) fd.append("face", faceFile);

  // Campos (texto)
  fd.append("category", category || "");
  fd.append("other_category", otherCategory.trim());
  fd.append("pockets", pockets || "");

  fd.append("model_type", modelType || "");
  fd.append("ethnicity", ethnicity || "");
  fd.append("age_range", ageRange || "");
  fd.append("background", background.trim());
  fd.append("pose", pose || "");
  fd.append("body_type", bodyType || "");

  fd.append("measures", JSON.stringify(measures));
}

function labelFromList<T extends { value: string; labelKey: string }>(
  list: readonly T[],
  value: string | ""
) {
  if (!value) return "";
  const item = list.find((x) => x.value === value);
  return item ? t(item.labelKey) : "";
}

  const API = (process.env.NEXT_PUBLIC_API_URL || "").replace(/\/$/, "");
  console.log("API URL:", API);
  const LAST_RESULT_KEY = "last_generation_result_v1";

  const [regenStartedAt, setRegenStartedAt] = useState<Record<string, number>>({});
  const regenLockRef = React.useRef<Record<string, boolean>>({});
  const [isMobile, setIsMobile] = useState(false);
  
const [genProgress, setGenProgress] = useState<{ total: number; done: number; current?: string } | null>(null);
const [genStatuses, setGenStatuses] = useState<Record<string, "pending" | "ok" | "fail">>({});
  console.log("PAGE LOADED âœ…", { isMobile });

  const [resultKeys, setResultKeys] = useState<Array<"front" | "back">>([]);
  const [regenLoading, setRegenLoading] = useState<Record<string, boolean>>({});

  const [user, setUser] = useState<any>(null);
  const [accessToken, setAccessToken] = useState<string | null>(null);
  const [balance, setBalance] = useState<number>(0);

  const [loadingMe, setLoadingMe] = useState(false);
  const [topupStatus, setTopupStatus] = useState<string | null>(null);

  const [entries, setEntries] = useState<any[]>([]);
  const [loadingEntries, setLoadingEntries] = useState(false);
  const [entriesPage, setEntriesPage] = useState(1);
  const ENTRIES_PAGE_SIZE = 10;

  const [selectedPack, setSelectedPack] = useState<"emprendedor" | "pyme" | "empresa">("emprendedor");
  const [buyLoading, setBuyLoading] = useState(false);

  const [mobileStepsOpen, setMobileStepsOpen] = useState(false);

  const [views, setViews] = useState({
  front: true,
  back: false,
  side: false,
  frontDetail: false,
  backDetail: false,
  pantFrontDetail: false,
  pantBackDetail: false,
  pantSideDetail: false,
  left: false,
  right: false,
});

  

  const cameraInputRef = React.useRef<HTMLInputElement | null>(null);
  const galleryInputRef = React.useRef<HTMLInputElement | null>(null);

  const frontCameraRef = React.useRef<HTMLInputElement | null>(null);
  const frontGalleryRef = React.useRef<HTMLInputElement | null>(null);
  const backCameraRef = React.useRef<HTMLInputElement | null>(null);
  const backGalleryRef = React.useRef<HTMLInputElement | null>(null);

  const hydratingRef = React.useRef(false);

  function mergeFiles(prev: File[], incoming: File[]) {
    // evita duplicados por: name + size + lastModified
    const map = new Map<string, File>();
    for (const f of prev) map.set(`${f.name}-${f.size}-${f.lastModified}`, f);
    for (const f of incoming) map.set(`${f.name}-${f.size}-${f.lastModified}`, f);
    return Array.from(map.values());
  }

  function addProductFiles(files: File[]) {
    if (!files.length) return;
    setProductFiles((prev) => mergeFiles(prev, files));
  }

  function removeProductFile(index: number) {
    setProductFiles((prev) => prev.filter((_, i) => i !== index));
  }

type Lang = "es" | "en" | "pt" | "ko" | "zh";

const translations = {
  es: {
    // header / auth
    title: "Fotonine | Generador IA",
    subtitle: "ElegÃ­ el tipo de imagen que querÃ©s generar",
    signIn: "Iniciar sesiÃ³n",
    signInHint: "AccedÃ© con tu cuenta de Google para usar el generador",
    logout: "Cerrar sesiÃ³n",
    scenePlaceholder: 'Ej: "colgado en percha de madera", "sobre arena hÃºmeda"',
    otherExample: "Ej: Camisa, Blusa, Collar, Gorra, etc",
    bgPlaceholder: 'Ej: "estudio gris con luz suave"',
    credits: "CrÃ©ditos",
    buyCredits: "Comprar crÃ©ditos",
    loading: "Cargando...",
    ethCaucasian: "CaucÃ¡sico/a",
    ethLatino: "Latino/a",
    ethAsian: "AsiÃ¡tico/a",
    ethBlack: "Negro/a",
    ethMediterranean: "MediterrÃ¡neo/a",
    poseSitting: "Sentado/a",
    poseStanding: "Parado/a",
    poseWalking: "Caminando",
    bodyStandard: "EstÃ¡ndar",
    bodyPlus: "Plus Size",
    m_hombros: "Hombros",
m_pecho: "Pecho",
m_manga: "Manga",
m_cintura: "Cintura",
m_cadera: "Cadera",
m_largo: "Largo",
exampleCm: "Ej: 52cm",
    // modes
    modeModel: "ðŸ“¸Foto con modelo",
    modeProduct: "âš›ï¸Foto producto",
    // steps titles
    stepUpload: "Subir fotos",
    catTop: "Remera / Top",
    catOuterwear: "Abrigo / Campera / Buzo",
    catBottom: "PantalÃ³n / Short / Pollera / Falda",
    catDress: "Vestido / Enterito",
    catSet: "Conjunto",
    catSwim: "Traje de baÃ±o",
    catBody: "Body",
    catOther: "Otro",
    age_0_2: "0 a 2 aÃ±os",
age_3_6: "3 a 6 aÃ±os",
age_6_10: "6 a 10 aÃ±os",
age_10_16: "10 a 16 aÃ±os",
age_18_24: "18 a 24 aÃ±os",
age_25_34: "25 a 34 aÃ±os",
age_35_44: "35 a 44 aÃ±os",
    stepCategory: "CategorÃ­a",
    stepPockets: "Bolsillos",
    stepMeasures: "Medidas (opcional)",
    stepModel: "Modelo",
    stepEthnicity: "Etnia",
    stepAge: "Edad",
    stepFace: "Rostro (opcional)",
    stepBackground: "Fondo",
    stepPose: "Pose",
    stepBodyType: "Tipo de cuerpo",
    stepScene: "Escena",
    stepGenerate: "Generar",
    modelNewborn: "BebÃ© reciÃ©n nacido",
    modelBoy: "NiÃ±o",
    modelGirl: "NiÃ±a",
    modelMan: "Hombre",
    modelWoman: "Mujer",
    // nav
    next: "Siguiente",
    back: "AtrÃ¡s",
    stepOf: (cur: number, total: number) => `Paso ${cur} de ${total}`,
    previous: "â† Anterior",
    following: "Siguiente â†’",
    pageXofY: (p: number, total: number) => `PÃ¡gina ${p} / ${total}`,
    // upload
    uploadTitle: "1) SubÃ­ fotos",
    productPhotosLabel: "Fotos del producto (cuantas mÃ¡s, mejor)",
    frontRequired: "Delantera (obligatorio)",
    backOptional: "Espalda (opcional)",
    takePhoto: "ðŸ“· Sacar foto",
    pickFromGallery: "ðŸ–¼ï¸ Elegir de galerÃ­a",
    missingApiBase: "Falta NEXT_PUBLIC_API_BASE en .env.local",
    missingApiUrl: "Falta NEXT_PUBLIC_API_URL en .env.local",
    preview: "Preview",
    remove: "Quitar",
    photosLoaded: (n: number) => `${n} foto(s) cargada(s)`,
    // category
    categoryTitle: "2) ElegÃ­ la categorÃ­a",
    other: "Otro",
    otherSpecify: "EspecificÃ¡ â€œOtroâ€ (mÃ¡x 4 palabras)",
    words: (n: number, max: number) => `Palabras: ${n} / ${max}`,
    // pockets
    pocketsTitle: "3) Â¿Tiene bolsillos?",
    yes: "SÃ­",
    no: "No",
    // measures
    measuresTitle: "4) Medidas (opcional)",
    measuresHint: "PodÃ©s poner cm. Ej: 52cm",
    // model/ethnicity/age/pose/bodyType
    modelTitle: "5) Tipo de modelo",
    ethnicityTitle: "6) Etnia",
    ageTitle: "7) Edad",
    chooseModelFirst: "ElegÃ­ primero el modelo",
    poseTitle: "9) Pose",
    bodyTypeTitle: "Tipo de cuerpo",

    // face
    faceTitle: "Rostro (opcional)",
    faceHint1: "âœ… Si subÃ­s el rostro, se intentarÃ¡ mantener el mismo rostro en todas las fotos.",
    faceHint2: "âš ï¸ Si NO lo subÃ­s, se pueden generar rostros diferentes en cada imagen.",
    takeFacePhoto: "ðŸ“· Sacar foto (rostro)",
    pickFaceGallery: "ðŸ–¼ï¸ Elegir de galerÃ­a (rostro)",
    genFace: "âœ¨ Generar rostro",
    genFaceLoading: "Generando rostro...",
    missingDataForFace: "ElegÃ­ tipo de modelo, etnia y edad antes de generar el rostro.",

    // background / scene
    backgroundTitle: "8) Fondo (mÃ¡x 10 palabras)",
    helpChoosePlace: "Ayudame a elegir",
    searching: "Buscando...",
    sceneTitle: "Escena del producto (mÃ¡x 10 palabras)",
    helpChoose: "Ayudame a elegir",

    // generate
    generateTitle: "11) Generar imÃ¡genes",
    summary: "Resumen",
    uploadedPhotos: "Fotos cargadas",
    viewsToGenerate: "Â¿QuÃ© vistas querÃ©s generar?",
    creditsToConsume: (n: number) => `CrÃ©ditos a consumir: ${n}`,
    generate: (n: number) => `Generar (${n} crÃ©dito${n > 1 ? "s" : ""})`,
    chooseAtLeastOneView: "ElegÃ­ al menos 1 vista",
    insufficientCredits: (n: number) => `CrÃ©ditos insuficientes (${n})`,
    generating: "Generando...",
    result: "Resultado",
    download: "â¬‡ï¸ Descargar",
    redo: "ðŸ” Rehacer (1 crÃ©dito)",
    noCreditsRedo: "Sin crÃ©ditos (1)",
    redoing: (sec: number) => `Rehaciendo... (${sec}s)`,

    // views model
    vFront: "Frente Completo",
    vBack: "Espalda Completo",
    vSide: "Costado Completo",
    vFrontDetail: "Detalle Frente",
    vBackDetail: "Detalle Espalda",
    vPantFrontDetail: "Detalle PantalÃ³n Frente",
    vPantBackDetail: "Detalle PantalÃ³n Espalda",
    vPantSideDetail: "Detalle PantalÃ³n Costado",

    // views product
    pFront: "Toma principal",
    pBack: "Ãngulo alternativo",
    pLeft: "Detalle cercano",
    pRight: "Otro Ã¡ngulo",

    // overlay
    regenOverlayTitle: "ðŸ” Rehaciendo imagenâ€¦",
    regenOverlayHint: "No cierres ni recargues la pÃ¡gina.",

    // topup
    topupOk: "âœ… CrÃ©ditos agregados correctamente",
    topupFail: "âŒ El pago fue rechazado",

    // history
    history: "Historial de movimientos",
    packEntrepreneur: "ðŸš€ Paquete Emprendedor â€” 50 crÃ©ditos / $75.000",
    packPyme: "ðŸ¢ Paquete PyME â€” 100 crÃ©ditos / $150.000",
    packEnterprise: "ðŸ“ˆ Paquete Empresa â€” 200 crÃ©ditos / $300.000",
    noMovements: "Sin movimientos",
    date: "Fecha",
    movement: "Movimiento",
    amount: "Cantidad",
    expired: "Expirado",
    purchase: "Compra",
    refund: "Reintegro",
    grant: "BonificaciÃ³n",
    consumeModel: "ðŸ“¸ Consumo",
    consumeProduct: "âš›ï¸ Consumo",
    consumeGeneric: "Consumo",

    // validations
    errUploadFront: "SubÃ­ la foto Delantera (obligatorio).",
    errUploadProduct: "SubÃ­ al menos 1 foto del producto.",
    errChooseCategory: "ElegÃ­ una categorÃ­a.",
    errOtherMissing: "CompletÃ¡ 'Otro' (mÃ¡x 4 palabras).",
    errOtherTooLong: "'Otro' debe tener mÃ¡ximo 4 palabras.",
    errPockets: "IndicÃ¡ si tiene bolsillos (si/no).",
    errSceneMissing: "EscribÃ­ la escena (mÃ¡x 10 palabras).",
    errSceneTooLong: "La escena debe tener mÃ¡ximo 10 palabras.",
    errModel: "ElegÃ­ el tipo de modelo.",
    errEthnicity: "ElegÃ­ la etnia.",
    errAge: "ElegÃ­ la edad.",
    errPose: "ElegÃ­ la pose.",
    errBodyType: "ElegÃ­ el tipo de cuerpo.",
    errBgMissing: "EscribÃ­ el fondo (mÃ¡x 10 palabras).",
    errBgTooLong: "El fondo debe tener mÃ¡ximo 10 palabras.",
    topupOkMsg: "âœ… CrÃ©ditos agregados correctamente",
    topupFailMsg: "âŒ El pago fue rechazado",
    processing: "Procesando...",
    buyCreditsBtn: "ðŸ’³ Comprar crÃ©ditos",
    logoutBtn: "ðŸšª Cerrar sesiÃ³n",
    loadingInline: "Cargando...",
    viewsToGenerateModel: "Â¿QuÃ© vistas querÃ©s generar?",
    sceneLabel: "Escena",
    prevPage: "â† Anterior",
    nextPage: "Siguiente â†’",
    // misc
    bonusExpiresIn: (hh: string, mm: string, ss: string) => `ðŸŽ Bonus de 3 crÃ©ditos â€” expira en ${hh}:${mm}:${ss}`,
    whatsapp: "WhatsApp",
    whatsappPrefill: "Hola, quiero ayuda con el generador",
  },

  en: {
    title: "Fotonine | AI Generator",
    subtitle: "Choose the type of image you want to generate",
    signIn: "Sign in",
    signInHint: "Sign in with Google to use the generator",
    logout: "Log out",
    bgPlaceholder: 'e.g. "gray studio with soft light"',
    credits: "Credits",
    scenePlaceholder: 'e.g. "hung on a wooden hanger", "on wet sand"',
    otherExample: "e.g. Shirt, Blouse, Necklace, Cap, etc",
    catTop: "Top / T-shirt",
    catOuterwear: "Jacket / Coat / Hoodie",
    catBottom: "Pants / Shorts / Skirt",
    catDress: "Dress / Jumpsuit",
    catSet: "Set",
    catSwim: "Swimwear",
    catBody: "Bodysuit",
    catOther: "Other",
    ethCaucasian: "Caucasian",
    ethLatino: "Latino",
    ethAsian: "Asian",
    ethBlack: "Black",
    ethMediterranean: "Mediterranean",
    age_0_2: "0 to 2 years",
age_3_6: "3 to 6 years",
age_6_10: "6 to 10 years",
age_10_16: "10 to 16 years",
age_18_24: "18 to 24 years",
age_25_34: "25 to 34 years",
age_35_44: "35 to 44 years",
m_hombros: "Shoulders",
m_pecho: "Chest",
m_manga: "Sleeve",
m_cintura: "Waist",
m_cadera: "Hips",
m_largo: "Length",
exampleCm: "e.g. 52cm",
    poseSitting: "Sitting",
    poseStanding: "Standing",
    poseWalking: "Walking",
    buyCredits: "Buy credits",
    bodyStandard: "Standard",
    bodyPlus: "Plus Size",
    loading: "Loading...",
    modeModel: "ðŸ“¸Model photo",
    modeProduct: "âš›ï¸Product photo",
    stepUpload: "Upload photos",
    stepCategory: "Category",
    stepPockets: "Pockets",
    stepMeasures: "Measurements (optional)",
    stepModel: "Model",
    stepEthnicity: "Ethnicity",
    missingApiBase: "Missing NEXT_PUBLIC_API_BASE in .env.local",
    missingApiUrl: "Missing NEXT_PUBLIC_API_URL in .env.local",
    stepAge: "Age",
    stepFace: "Face (optional)",
    stepBackground: "Background",
    stepPose: "Pose",
    stepBodyType: "Body type",
    stepScene: "Scene",
    stepGenerate: "Generate",
    modelNewborn: "Newborn baby",
    modelBoy: "Boy",
    modelGirl: "Girl",
    modelMan: "Man",
    modelWoman: "Woman",
    next: "Next",
    back: "Back",
    stepOf: (cur: number, total: number) => `Step ${cur} of ${total}`,
    previous: "â† Previous",
    following: "Next â†’",
    pageXofY: (p: number, total: number) => `Page ${p} / ${total}`,
    uploadTitle: "1) Upload photos",
    productPhotosLabel: "Product photos (the more, the better)",
    frontRequired: "Front (required)",
    backOptional: "Back (optional)",
    takePhoto: "ðŸ“· Take photo",
    pickFromGallery: "ðŸ–¼ï¸ Choose from gallery",
    preview: "Preview",
    remove: "Remove",
    photosLoaded: (n: number) => `${n} photo(s) uploaded`,
    categoryTitle: "2) Choose the category",
    other: "Other",
    otherSpecify: "Specify â€œOtherâ€ (max 4 words)",
    words: (n: number, max: number) => `Words: ${n} / ${max}`,
    pocketsTitle: "3) Does it have pockets?",
    yes: "Yes",
    no: "No",
    measuresTitle: "4) Measurements (optional)",
    measuresHint: "You can use cm. Example: 52cm",
    modelTitle: "5) Model type",
    ethnicityTitle: "6) Ethnicity",
    ageTitle: "7) Age",
    chooseModelFirst: "Choose the model first",
    poseTitle: "9) Pose",
    bodyTypeTitle: "Body type",
    faceTitle: "Face (optional)",
    faceHint1: "âœ… If you upload a face, weâ€™ll try to keep the same face across all images.",
    faceHint2: "âš ï¸ If you donâ€™t, faces may differ between images.",
    takeFacePhoto: "ðŸ“· Take face photo",
    pickFaceGallery: "ðŸ–¼ï¸ Choose face photo",
    genFace: "âœ¨ Generate face",
    genFaceLoading: "Generating face...",
    missingDataForFace: "Pick model type, ethnicity and age before generating the face.",
    backgroundTitle: "8) Background (max 10 words)",
    helpChoosePlace: "Help me pick",
    searching: "Searching...",
    sceneTitle: "Product scene (max 10 words)",
    helpChoose: "Help me pick",
    generateTitle: "11) Generate images",
    summary: "Summary",
    uploadedPhotos: "Uploaded photos",
    viewsToGenerate: "Which views do you want to generate?",
    creditsToConsume: (n: number) => `Credits to spend: ${n}`,
    generate: (n: number) => `Generate (${n} credit${n > 1 ? "s" : ""})`,
    chooseAtLeastOneView: "Pick at least 1 view",
    insufficientCredits: (n: number) => `Not enough credits (${n})`,
    generating: "Generating...",
    result: "Result",
    download: "â¬‡ï¸ Download",
    redo: "ðŸ” Redo (1 credit)",
    noCreditsRedo: "No credits (1)",
    redoing: (sec: number) => `Redoing... (${sec}s)`,
    vFront: "Full Front",
    vBack: "Full Back",
    vSide: "Full Side",
    vFrontDetail: "Front Detail",
    vBackDetail: "Back Detail",
    vPantFrontDetail: "Pants Front Detail",
    vPantBackDetail: "Pants Back Detail",
    vPantSideDetail: "Pants Side Detail",
    pFront: "Main shot",
    pBack: "Alternate angle",
    pLeft: "Close-up detail",
    pRight: "Another angle",
    regenOverlayTitle: "ðŸ” Redoing imageâ€¦",
    regenOverlayHint: "Donâ€™t close or refresh the page.",
    topupOk: "âœ… Credits added successfully",
    topupFail: "âŒ Payment was rejected",
    history: "Transaction history",
    noMovements: "No transactions",
    date: "Date",
    movement: "Type",
    amount: "Amount",
    expired: "Expired",
    purchase: "Purchase",
    refund: "Refund",
    grant: "Bonus",
    consumeModel: "ðŸ“¸ Usage",
    consumeProduct: "âš›ï¸ Usage",
    consumeGeneric: "Usage",
    topupOkMsg: "âœ… Credits added successfully",
    topupFailMsg: "âŒ Payment was rejected",
    processing: "Processing...",
    buyCreditsBtn: "ðŸ’³ Buy credits",
    logoutBtn: "ðŸšª Log out",
    loadingInline: "Loading...",
    viewsToGenerateModel: "Which views do you want to generate?",
    sceneLabel: "Scene",
    prevPage: "â† Previous",
    nextPage: "Next â†’",
    errUploadFront: "Upload the Front photo (required).",
    packEntrepreneur: "ðŸš€ Entrepreneur Pack â€” 50 credits / $75,000",
    packPyme: "ðŸ¢ SME Pack â€” 100 credits / $150,000",
    packEnterprise: "ðŸ“ˆ Enterprise Pack â€” 200 credits / $300,000",
    errUploadProduct: "Upload at least 1 product photo.",
    errChooseCategory: "Choose a category.",
    errOtherMissing: "Fill in 'Other' (max 4 words).",
    errOtherTooLong: "'Other' must be max 4 words.",
    errPockets: "Select pockets (yes/no).",
    errSceneMissing: "Write the scene (max 10 words).",
    errSceneTooLong: "Scene must be max 10 words.",
    errModel: "Choose the model type.",
    errEthnicity: "Choose the ethnicity.",
    errAge: "Choose the age.",
    errPose: "Choose the pose.",
    errBodyType: "Choose the body type.",
    errBgMissing: "Write the background (max 10 words).",
    errBgTooLong: "Background must be max 10 words.",
    bonusExpiresIn: (hh: string, mm: string, ss: string) => `ðŸŽ 3-credit bonus â€” expires in ${hh}:${mm}:${ss}`,
    whatsapp: "WhatsApp",
    whatsappPrefill: "Hi, I need help with the generator",
  },

 pt: {
  // header / auth
  title: "Fotonine | Gerador IA",
  subtitle: "Escolha o tipo de imagem que vocÃª quer gerar",
  signIn: "Entrar",
  signInHint: "Entre com sua conta Google para usar o gerador",
  logout: "Sair",
  credits: "CrÃ©ditos",
  scenePlaceholder: 'Ex: "pendurado em cabide de madeira", "na areia Ãºmida"',
  otherExample: "Ex: Camisa, Blusa, Colar, BonÃ©, etc",
  bgPlaceholder: 'Ex: "estÃºdio cinza com luz suave"',
  buyCredits: "Comprar crÃ©ditos",
  loading: "Carregando...",
  processing: "Processando...",
  poseSitting: "Sentado/a",
  poseStanding: "Em pÃ©",
  poseWalking: "Caminhando",
  // modes
  modeModel: "ðŸ“¸ Foto com modelo",
  modeProduct: "âš›ï¸ Foto do produto",  
  ethCaucasian: "Caucasiano/a", 
  ethLatino: "Latino/a",  
  ethAsian: "AsiÃ¡tico/a", 
  ethBlack: "Negro/a",
  ethMediterranean: "MediterrÃ¢neo/a",
  bodyStandard: "PadrÃ£o",
  bodyPlus: "Plus Size",
  age_0_2: "0 a 2 anos",
age_3_6: "3 a 6 anos",
age_6_10: "6 a 10 anos",
age_10_16: "10 a 16 anos",
age_18_24: "18 a 24 anos",
age_25_34: "25 a 34 anos",
age_35_44: "35 a 44 anos",
m_hombros: "Ombros",
m_pecho: "Peito",
m_manga: "Manga",
m_cintura: "Cintura",
m_cadera: "Quadril",
m_largo: "Comprimento",
exampleCm: "Ex: 52cm",
  // steps titles
  stepUpload: "Enviar fotos",
  stepCategory: "Categoria",
  stepPockets: "Bolsos",
  stepMeasures: "Medidas (opcional)",
  stepModel: "Modelo",
  stepEthnicity: "Etnia",
  stepAge: "Idade",
  stepFace: "Rosto (opcional)",
  stepBackground: "Fundo",
  stepPose: "Pose",
  stepBodyType: "Tipo de corpo",
  stepScene: "Cena",
  stepGenerate: "Gerar",

  // nav
  next: "PrÃ³ximo",
  back: "Voltar",
  stepOf: (cur: number, total: number) => `Passo ${cur} de ${total}`,
  previous: "â† Anterior",
  following: "PrÃ³ximo â†’",
  pageXofY: (p: number, total: number) => `PÃ¡gina ${p} / ${total}`,

  // upload
  uploadTitle: "1) Envie fotos",
  productPhotosLabel: "Fotos do produto (quanto mais, melhor)",
  frontRequired: "Frente (obrigatÃ³rio)",
  backOptional: "Costas (opcional)",
  takePhoto: "ðŸ“· Tirar foto",
  pickFromGallery: "ðŸ–¼ï¸ Escolher da galeria",
  preview: "PrÃ©via",
  remove: "Remover",
  photosLoaded: (n: number) => `${n} foto(s) enviada(s)`,

  // category
  categoryTitle: "2) Escolha a categoria",
  other: "Outro",
  otherSpecify: "Especifique â€œOutroâ€ (mÃ¡x. 4 palavras)",
  words: (n: number, max: number) => `Palavras: ${n} / ${max}`,

  // pockets
  pocketsTitle: "3) Tem bolsos?",
  yes: "Sim",
  no: "NÃ£o",

  // measures
  measuresTitle: "4) Medidas (opcional)",
  measuresHint: "VocÃª pode usar cm. Ex: 52cm",

  // model/ethnicity/age/pose/bodyType
  modelTitle: "5) Tipo de modelo",
  ethnicityTitle: "6) Etnia",
  ageTitle: "7) Idade",
  chooseModelFirst: "Escolha o modelo primeiro",
  poseTitle: "9) Pose",
  bodyTypeTitle: "Tipo de corpo",
  modelNewborn: "BebÃª recÃ©m-nascido",
  modelBoy: "Menino",
  modelGirl: "Menina",
  modelMan: "Homem",
  modelWoman: "Mulher",
  // face
  faceTitle: "Rosto (opcional)",
  faceHint1: "âœ… Se vocÃª enviar o rosto, tentaremos manter o mesmo rosto em todas as fotos.",
  faceHint2: "âš ï¸ Se vocÃª NÃƒO enviar, os rostos podem variar entre as imagens.",
  takeFacePhoto: "ðŸ“· Tirar foto (rosto)",
  pickFaceGallery: "ðŸ–¼ï¸ Escolher da galeria (rosto)",
  genFace: "âœ¨ Gerar rosto",
  genFaceLoading: "Gerando rosto...",
  missingDataForFace: "Escolha tipo de modelo, etnia e idade antes de gerar o rosto.",

  // background / scene
  backgroundTitle: "8) Fundo (mÃ¡x. 10 palavras)",
  helpChoosePlace: "Me ajude a escolher",
  searching: "Buscando...",
  sceneTitle: "Cena do produto (mÃ¡x. 10 palavras)",
  helpChoose: "Me ajude a escolher",

  // generate
  generateTitle: "11) Gerar imagens",
  summary: "Resumo",
  uploadedPhotos: "Fotos enviadas",
  viewsToGenerate: "Quais vistas vocÃª quer gerar?",
  creditsToConsume: (n: number) => `CrÃ©ditos a consumir: ${n}`,
  generate: (n: number) => `Gerar (${n} crÃ©dito${n > 1 ? "s" : ""})`,
  chooseAtLeastOneView: "Escolha pelo menos 1 vista",
  insufficientCredits: (n: number) => `CrÃ©ditos insuficientes (${n})`,
  generating: "Gerando...",
  result: "Resultado",
  download: "â¬‡ï¸ Baixar",
  redo: "ðŸ” Refazer (1 crÃ©dito)",
  noCreditsRedo: "Sem crÃ©ditos (1)",
  redoing: (sec: number) => `Refazendo... (${sec}s)`,

  // views model
  vFront: "Frente (corpo inteiro)",
  vBack: "Costas (corpo inteiro)",
  vSide: "Lado (corpo inteiro)",
  vFrontDetail: "Detalhe frontal",
  vBackDetail: "Detalhe traseiro",
  vPantFrontDetail: "Detalhe calÃ§a (frente)",
  vPantBackDetail: "Detalhe calÃ§a (costas)",
  vPantSideDetail: "Detalhe calÃ§a (lado)",

  // views product
  pFront: "Foto principal",
  pBack: "Ã‚ngulo alternativo",
  pLeft: "Detalhe de perto",
  pRight: "Outro Ã¢ngulo",

  // overlay
  regenOverlayTitle: "ðŸ” Refazendo imagemâ€¦",
  regenOverlayHint: "NÃ£o feche nem recarregue a pÃ¡gina.",

  // topup
  topupOk: "âœ… CrÃ©ditos adicionados com sucesso",
  topupFail: "âŒ Pagamento rejeitado",

  // history
  history: "HistÃ³rico de movimentos",
  packEntrepreneur: "ðŸš€ Pacote Empreendedor â€” 50 crÃ©ditos / $75.000",
  packPyme: "ðŸ¢ Pacote PyME â€” 100 crÃ©ditos / $150.000",
  packEnterprise: "ðŸ“ˆ Pacote Empresa â€” 200 crÃ©ditos / $300.000",
  noMovements: "Sem movimentos",
  date: "Data",
  movement: "Movimento",
  amount: "Quantidade",
  expired: "Expirado",
  purchase: "Compra",
  refund: "Reembolso",
  grant: "BÃ´nus",
  consumeModel: "ðŸ“¸ Uso",
  consumeProduct: "âš›ï¸ Uso",
  consumeGeneric: "Uso",

  // validations
  catTop: "Camiseta / Top",
  catOuterwear: "Jaqueta / Casaco / Moletom",
  catBottom: "CalÃ§a / Short / Saia",
  catDress: "Vestido / MacacÃ£o",
  catSet: "Conjunto",
  catSwim: "Moda praia",
  catBody: "Body",
  catOther: "Outro",
  errUploadFront: "Envie a foto da Frente (obrigatÃ³rio).",
  errUploadProduct: "Envie pelo menos 1 foto do produto.",
  errChooseCategory: "Escolha uma categoria.",
  errOtherMissing: "Preencha 'Outro' (mÃ¡x. 4 palavras).",
  errOtherTooLong: "'Outro' deve ter no mÃ¡ximo 4 palavras.",
  errPockets: "Indique se tem bolsos (sim/nÃ£o).",
  errSceneMissing: "Escreva a cena (mÃ¡x. 10 palavras).",
  errSceneTooLong: "A cena deve ter no mÃ¡ximo 10 palavras.",
  errModel: "Escolha o tipo de modelo.",
  errEthnicity: "Escolha a etnia.",
  errAge: "Escolha a idade.",
  errPose: "Escolha a pose.",
  errBodyType: "Escolha o tipo de corpo.",
  errBgMissing: "Escreva o fundo (mÃ¡x. 10 palavras).",
  errBgTooLong: "O fundo deve ter no mÃ¡ximo 10 palavras.",

  // misc
  bonusExpiresIn: (hh: string, mm: string, ss: string) => `ðŸŽ BÃ´nus de 3 crÃ©ditos â€” expira em ${hh}:${mm}:${ss}`,
  whatsapp: "WhatsApp",
  whatsappPrefill: "OlÃ¡, preciso de ajuda com o gerador",
  missingApiBase: "Missing NEXT_PUBLIC_API_BASE in .env.local",
  missingApiUrl: "Missing NEXT_PUBLIC_API_URL in .env.local",
} as any,

ko: {
  title: "Fotonine | AI ìƒì„±ê¸°",
  subtitle: "ìƒì„±í•  ì´ë¯¸ì§€ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”",
  signIn: "ë¡œê·¸ì¸",
  signInHint: "Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•´ ìƒì„±ê¸°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”",
  logout: "ë¡œê·¸ì•„ì›ƒ",
  credits: "í¬ë ˆë”§",
  scenePlaceholder: 'ì˜ˆ: "ë‚˜ë¬´ ì˜·ê±¸ì´ì— ê±¸ë¦°", "ì –ì€ ëª¨ëž˜ ìœ„"',
  otherExample: "ì˜ˆ: ì…”ì¸ , ë¸”ë¼ìš°ìŠ¤, ëª©ê±¸ì´, ëª¨ìž ë“±",
  bgPlaceholder: 'ì˜ˆ: "ë¶€ë“œëŸ¬ìš´ ì¡°ëª…ì´ ìžˆëŠ” íšŒìƒ‰ ìŠ¤íŠœë””ì˜¤"',
  buyCredits: "í¬ë ˆë”§ êµ¬ë§¤",
  loading: "ë¡œë”© ì¤‘...",
  processing: "ì²˜ë¦¬ ì¤‘...",
  ethCaucasian: "ë°±ì¸",
  ethLatino: "ë¼í‹´ê³„",
  ethAsian: "ì•„ì‹œì•„ê³„",
  ethBlack: "í‘ì¸",
  ethMediterranean: "ì§€ì¤‘í•´ê³„",
  modeModel: "ðŸ“¸ ëª¨ë¸ ì‚¬ì§„",
  modeProduct: "âš›ï¸ ì œí’ˆ ì‚¬ì§„",
  catTop: "ìƒì˜",
  catOuterwear: "ì•„ìš°í„°",
  catBottom: "í•˜ì˜",
  catDress: "ì›í”¼ìŠ¤/ì í”„ìˆ˜íŠ¸",
  catSet: "ì„¸íŠ¸",
  catSwim: "ìˆ˜ì˜ë³µ",
  catBody: "ë°”ë””ìˆ˜íŠ¸",
  catOther: "ê¸°íƒ€",
  poseSitting: "ì•‰ì•„ ìžˆìŒ",
  poseStanding: "ì„œ ìžˆìŒ",
  poseWalking: "ê±·ëŠ” ì¤‘",
  bodyStandard: "í‘œì¤€ ì²´í˜•",
  bodyPlus: "í”ŒëŸ¬ìŠ¤ ì‚¬ì´ì¦ˆ",
  age_0_2: "0~2ì„¸",
age_3_6: "3~6ì„¸",
age_6_10: "6~10ì„¸",
age_10_16: "10~16ì„¸",
age_18_24: "18~24ì„¸",
age_25_34: "25~34ì„¸",
age_35_44: "35~44ì„¸",
m_hombros: "ì–´ê¹¨",
m_pecho: "ê°€ìŠ´",
m_manga: "ì†Œë§¤",
m_cintura: "í—ˆë¦¬",
m_cadera: "ì—‰ë©ì´",
m_largo: "ê¸¸ì´",
exampleCm: "ì˜ˆ: 52cm",
  stepUpload: "ì‚¬ì§„ ì—…ë¡œë“œ",
  stepCategory: "ì¹´í…Œê³ ë¦¬",
  stepPockets: "ì£¼ë¨¸ë‹ˆ",
  stepMeasures: "ì¹˜ìˆ˜(ì„ íƒ)",
  stepModel: "ëª¨ë¸",
  stepEthnicity: "ì¸ì¢…/í”¼ë¶€í†¤",
  stepAge: "ë‚˜ì´",
  stepFace: "ì–¼êµ´(ì„ íƒ)",
  stepBackground: "ë°°ê²½",
  stepPose: "í¬ì¦ˆ",
  stepBodyType: "ì²´í˜•",
  stepScene: "ìž¥ë©´",
  stepGenerate: "ìƒì„±",

  next: "ë‹¤ìŒ",
  back: "ë’¤ë¡œ",
  stepOf: (cur: number, total: number) => `ë‹¨ê³„ ${cur} / ${total}`,
  previous: "â† ì´ì „",
  following: "ë‹¤ìŒ â†’",
  pageXofY: (p: number, total: number) => `íŽ˜ì´ì§€ ${p} / ${total}`,

  uploadTitle: "1) ì‚¬ì§„ ì—…ë¡œë“œ",
  productPhotosLabel: "ì œí’ˆ ì‚¬ì§„(ë§Žì„ìˆ˜ë¡ ì¢‹ì•„ìš”)",
  frontRequired: "ì •ë©´(í•„ìˆ˜)",
  backOptional: "í›„ë©´(ì„ íƒ)",
  takePhoto: "ðŸ“· ì‚¬ì§„ ì°ê¸°",
  pickFromGallery: "ðŸ–¼ï¸ ê°¤ëŸ¬ë¦¬ì—ì„œ ì„ íƒ",
  preview: "ë¯¸ë¦¬ë³´ê¸°",
  remove: "ì‚­ì œ",
  photosLoaded: (n: number) => `${n}ìž¥ ì—…ë¡œë“œë¨`,

  categoryTitle: "2) ì¹´í…Œê³ ë¦¬ ì„ íƒ",
  other: "ê¸°íƒ€",
  otherSpecify: "â€œê¸°íƒ€â€ë¥¼ ìž…ë ¥í•˜ì„¸ìš”(ìµœëŒ€ 4ë‹¨ì–´)",
  words: (n: number, max: number) => `ë‹¨ì–´: ${n} / ${max}`,

  pocketsTitle: "3) ì£¼ë¨¸ë‹ˆê°€ ìžˆë‚˜ìš”?",
  yes: "ì˜ˆ",
  no: "ì•„ë‹ˆì˜¤",

  measuresTitle: "4) ì¹˜ìˆ˜(ì„ íƒ)",
  measuresHint: "cm ì‚¬ìš© ê°€ëŠ¥. ì˜ˆ: 52cm",

  modelTitle: "5) ëª¨ë¸ ìœ í˜•",
  ethnicityTitle: "6) ì¸ì¢…/í”¼ë¶€í†¤",
  ageTitle: "7) ë‚˜ì´",
  chooseModelFirst: "ë¨¼ì € ëª¨ë¸ì„ ì„ íƒí•˜ì„¸ìš”",
  poseTitle: "9) í¬ì¦ˆ",
  bodyTypeTitle: "ì²´í˜•",
  modelNewborn: "ì‹ ìƒì•„",
  modelBoy: "ë‚¨ìžì•„ì´",
  modelGirl: "ì—¬ìžì•„ì´",
  modelMan: "ë‚¨ì„±",
  modelWoman: "ì—¬ì„±",

  faceTitle: "ì–¼êµ´(ì„ íƒ)",
  faceHint1: "âœ… ì–¼êµ´ì„ ì—…ë¡œë“œí•˜ë©´ ëª¨ë“  ì´ë¯¸ì§€ì—ì„œ ê°™ì€ ì–¼êµ´ì„ ìœ ì§€í•˜ë ¤ê³  í•©ë‹ˆë‹¤.",
  faceHint2: "âš ï¸ ì—…ë¡œë“œí•˜ì§€ ì•Šìœ¼ë©´ ì´ë¯¸ì§€ë§ˆë‹¤ ì–¼êµ´ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.",
  takeFacePhoto: "ðŸ“· ì–¼êµ´ ì‚¬ì§„ ì°ê¸°",
  pickFaceGallery: "ðŸ–¼ï¸ ì–¼êµ´ ì‚¬ì§„ ì„ íƒ",
  genFace: "âœ¨ ì–¼êµ´ ìƒì„±",
  genFaceLoading: "ì–¼êµ´ ìƒì„± ì¤‘...",
  missingDataForFace: "ì–¼êµ´ ìƒì„± ì „ì— ëª¨ë¸/ì¸ì¢…/ë‚˜ì´ë¥¼ ì„ íƒí•˜ì„¸ìš”.",

  backgroundTitle: "8) ë°°ê²½(ìµœëŒ€ 10ë‹¨ì–´)",
  helpChoosePlace: "ì¶”ì²œ ë°›ê¸°",
  searching: "ê²€ìƒ‰ ì¤‘...",
  sceneTitle: "ì œí’ˆ ìž¥ë©´(ìµœëŒ€ 10ë‹¨ì–´)",
  helpChoose: "ì¶”ì²œ ë°›ê¸°",

  generateTitle: "11) ì´ë¯¸ì§€ ìƒì„±",
  summary: "ìš”ì•½",
  uploadedPhotos: "ì—…ë¡œë“œí•œ ì‚¬ì§„",
  viewsToGenerate: "ì–´ë–¤ ë·°ë¥¼ ìƒì„±í• ê¹Œìš”?",
  creditsToConsume: (n: number) => `ì‚¬ìš© í¬ë ˆë”§: ${n}`,
  generate: (n: number) => `ìƒì„± (${n} í¬ë ˆë”§)`,
  chooseAtLeastOneView: "ìµœì†Œ 1ê°œ ë·°ë¥¼ ì„ íƒí•˜ì„¸ìš”",
  insufficientCredits: (n: number) => `í¬ë ˆë”§ì´ ë¶€ì¡±í•©ë‹ˆë‹¤ (${n})`,
  generating: "ìƒì„± ì¤‘...",
  result: "ê²°ê³¼",
  download: "â¬‡ï¸ ë‹¤ìš´ë¡œë“œ",
  redo: "ðŸ” ë‹¤ì‹œ ìƒì„± (1 í¬ë ˆë”§)",
  noCreditsRedo: "í¬ë ˆë”§ ì—†ìŒ (1)",
  redoing: (sec: number) => `ë‹¤ì‹œ ìƒì„± ì¤‘... (${sec}s)`,

  vFront: "ì •ë©´ ì „ì²´",
  vBack: "í›„ë©´ ì „ì²´",
  vSide: "ì¸¡ë©´ ì „ì²´",
  vFrontDetail: "ì •ë©´ ë””í…Œì¼",
  vBackDetail: "í›„ë©´ ë””í…Œì¼",
  vPantFrontDetail: "ë°”ì§€ ë””í…Œì¼(ì •ë©´)",
  vPantBackDetail: "ë°”ì§€ ë””í…Œì¼(í›„ë©´)",
  vPantSideDetail: "ë°”ì§€ ë””í…Œì¼(ì¸¡ë©´)",

  pFront: "ë©”ì¸ ìƒ·",
  pBack: "ëŒ€ì²´ ê°ë„",
  pLeft: "ê·¼ì ‘ ë””í…Œì¼",
  pRight: "ë‹¤ë¥¸ ê°ë„",

  regenOverlayTitle: "ðŸ” ì´ë¯¸ì§€ ë‹¤ì‹œ ìƒì„± ì¤‘â€¦",
  regenOverlayHint: "íŽ˜ì´ì§€ë¥¼ ë‹«ê±°ë‚˜ ìƒˆë¡œê³ ì¹¨í•˜ì§€ ë§ˆì„¸ìš”.",

  topupOk: "âœ… í¬ë ˆë”§ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤",
  topupFail: "âŒ ê²°ì œê°€ ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤",

  history: "ê±°ëž˜ ë‚´ì—­",
  packEntrepreneur: "ðŸš€ ì°½ì—…ìž íŒ¨í‚¤ì§€ â€” 50 í¬ë ˆë”§ / $75,000",
  packPyme: "ðŸ¢ SME íŒ¨í‚¤ì§€ â€” 100 í¬ë ˆë”§ / $150,000",
  packEnterprise: "ðŸ“ˆ ê¸°ì—… íŒ¨í‚¤ì§€ â€” 200 í¬ë ˆë”§ / $300,000",
  noMovements: "ë‚´ì—­ ì—†ìŒ",
  date: "ë‚ ì§œ",
  movement: "ìœ í˜•",
  amount: "ìˆ˜ëŸ‰",
  expired: "ë§Œë£Œë¨",
  purchase: "êµ¬ë§¤",
  refund: "í™˜ë¶ˆ",
  grant: "ë³´ë„ˆìŠ¤",
  consumeModel: "ðŸ“¸ ì‚¬ìš©",
  consumeProduct: "âš›ï¸ ì‚¬ìš©",
  consumeGeneric: "ì‚¬ìš©",

  errUploadFront: "ì •ë©´ ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ì„¸ìš”(í•„ìˆ˜).",
  errUploadProduct: "ì œí’ˆ ì‚¬ì§„ì„ ìµœì†Œ 1ìž¥ ì—…ë¡œë“œí•˜ì„¸ìš”.",
  errChooseCategory: "ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”.",
  errOtherMissing: "â€˜ê¸°íƒ€â€™ë¥¼ ìž…ë ¥í•˜ì„¸ìš”(ìµœëŒ€ 4ë‹¨ì–´).",
  errOtherTooLong: "â€˜ê¸°íƒ€â€™ëŠ” ìµœëŒ€ 4ë‹¨ì–´ìž…ë‹ˆë‹¤.",
  errPockets: "ì£¼ë¨¸ë‹ˆ ì—¬ë¶€ë¥¼ ì„ íƒí•˜ì„¸ìš”(ì˜ˆ/ì•„ë‹ˆì˜¤).",
  errSceneMissing: "ìž¥ë©´ì„ ìž…ë ¥í•˜ì„¸ìš”(ìµœëŒ€ 10ë‹¨ì–´).",
  errSceneTooLong: "ìž¥ë©´ì€ ìµœëŒ€ 10ë‹¨ì–´ìž…ë‹ˆë‹¤.",
  errModel: "ëª¨ë¸ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”.",
  errEthnicity: "ì¸ì¢…/í”¼ë¶€í†¤ì„ ì„ íƒí•˜ì„¸ìš”.",
  errAge: "ë‚˜ì´ë¥¼ ì„ íƒí•˜ì„¸ìš”.",
  errPose: "í¬ì¦ˆë¥¼ ì„ íƒí•˜ì„¸ìš”.",
  errBodyType: "ì²´í˜•ì„ ì„ íƒí•˜ì„¸ìš”.",
  errBgMissing: "ë°°ê²½ì„ ìž…ë ¥í•˜ì„¸ìš”(ìµœëŒ€ 10ë‹¨ì–´).",
  errBgTooLong: "ë°°ê²½ì€ ìµœëŒ€ 10ë‹¨ì–´ìž…ë‹ˆë‹¤.",

  bonusExpiresIn: (hh: string, mm: string, ss: string) => `ðŸŽ 3í¬ë ˆë”§ ë³´ë„ˆìŠ¤ â€” ${hh}:${mm}:${ss} í›„ ë§Œë£Œ`,
  whatsapp: "WhatsApp",
  whatsappPrefill: "ì•ˆë…•í•˜ì„¸ìš”, ìƒì„±ê¸° ë„ì›€ì„ ë°›ê³  ì‹¶ì–´ìš”",
  missingApiBase: "Missing NEXT_PUBLIC_API_BASE in .env.local",
  missingApiUrl: "Missing NEXT_PUBLIC_API_URL in .env.local",
} as any,

zh: {
  title: "Fotonine | AI ç”Ÿæˆå™¨",
  subtitle: "é€‰æ‹©ä½ æƒ³ç”Ÿæˆçš„å›¾ç‰‡ç±»åž‹",
  signIn: "ç™»å½•",
  signInHint: "ä½¿ç”¨ Google ç™»å½•ä»¥ä½¿ç”¨ç”Ÿæˆå™¨",
  logout: "é€€å‡ºç™»å½•",
  credits: "ç§¯åˆ†",
  scenePlaceholder: 'ä¾‹å¦‚ï¼šâ€œæŒ‚åœ¨æœ¨è¡£æž¶ä¸Šâ€ï¼Œâ€œåœ¨æ¹¿æ²™ä¸Šâ€',
  otherExample: "ä¾‹å¦‚ï¼šè¡¬è¡«ã€å¥³å¼ä¸Šè¡£ã€é¡¹é“¾ã€å¸½å­ç­‰",
  bgPlaceholder: 'ä¾‹å¦‚ï¼š"æŸ”å’Œç¯å…‰çš„ç°è‰²å½±æ£š"',
  buyCredits: "è´­ä¹°ç§¯åˆ†",
  loading: "åŠ è½½ä¸­...",
  processing: "å¤„ç†ä¸­...",
  ethCaucasian: "é«˜åŠ ç´¢",
  ethLatino: "æ‹‰ä¸è£”",
  ethAsian: "äºšè£”",
  ethBlack: "é»‘äºº",
  ethMediterranean: "åœ°ä¸­æµ·è£”",
  modeModel: "ðŸ“¸ æ¨¡ç‰¹ç…§ç‰‡",
  modeProduct: "âš›ï¸ äº§å“ç…§ç‰‡",
  catTop: "ä¸Šè¡£",
  catOuterwear: "å¤–å¥—",
  catBottom: "ä¸‹è£…",
  catDress: "è¿žè¡£è£™/è¿žä½“è£¤",
  catSet: "å¥—è£…",
  catSwim: "æ³³è£…",
  catBody: "è¿žä½“è¡£",
  catOther: "å…¶ä»–",
  poseSitting: "åç€",
  poseStanding: "ç«™ç«‹",
  poseWalking: "è¡Œèµ°",
  bodyStandard: "æ ‡å‡†ä½“åž‹",
  bodyPlus: "åŠ å¤§ç ",
  age_0_2: "0-2 å²",
age_3_6: "3-6 å²",
age_6_10: "6-10 å²",
age_10_16: "10-16 å²",
age_18_24: "18-24 å²",
age_25_34: "25-34 å²",
age_35_44: "35-44 å²",
m_hombros: "è‚©å®½",
m_pecho: "èƒ¸å›´",
m_manga: "è¢–é•¿",
m_cintura: "è…°å›´",
m_cadera: "è‡€å›´",
m_largo: "è¡£é•¿",
exampleCm: "ä¾‹å¦‚ï¼š52cm",
  stepUpload: "ä¸Šä¼ ç…§ç‰‡",
  stepCategory: "ç±»åˆ«",
  stepPockets: "å£è¢‹",
  stepMeasures: "å°ºå¯¸ï¼ˆå¯é€‰ï¼‰",
  stepModel: "æ¨¡ç‰¹",
  stepEthnicity: "äººç§/è‚¤è‰²",
  stepAge: "å¹´é¾„",
  stepFace: "é¢éƒ¨ï¼ˆå¯é€‰ï¼‰",
  stepBackground: "èƒŒæ™¯",
  stepPose: "å§¿åŠ¿",
  stepBodyType: "ä½“åž‹",
  stepScene: "åœºæ™¯",
  stepGenerate: "ç”Ÿæˆ",

  next: "ä¸‹ä¸€æ­¥",
  back: "è¿”å›ž",
  stepOf: (cur: number, total: number) => `ç¬¬ ${cur} æ­¥ / å…± ${total} æ­¥`,
  previous: "â† ä¸Šä¸€é¡µ",
  following: "ä¸‹ä¸€é¡µ â†’",
  pageXofY: (p: number, total: number) => `ç¬¬ ${p} é¡µ / å…± ${total} é¡µ`,

  uploadTitle: "1) ä¸Šä¼ ç…§ç‰‡",
  productPhotosLabel: "äº§å“ç…§ç‰‡ï¼ˆè¶Šå¤šè¶Šå¥½ï¼‰",
  frontRequired: "æ­£é¢ï¼ˆå¿…å¡«ï¼‰",
  backOptional: "èƒŒé¢ï¼ˆå¯é€‰ï¼‰",
  takePhoto: "ðŸ“· æ‹ç…§",
  pickFromGallery: "ðŸ–¼ï¸ ä»Žç›¸å†Œé€‰æ‹©",
  preview: "é¢„è§ˆ",
  remove: "ç§»é™¤",
  photosLoaded: (n: number) => `å·²ä¸Šä¼  ${n} å¼ ç…§ç‰‡`,

  categoryTitle: "2) é€‰æ‹©ç±»åˆ«",
  other: "å…¶ä»–",
  otherSpecify: "è¯·å¡«å†™â€œå…¶ä»–â€ï¼ˆæœ€å¤š 4 ä¸ªè¯ï¼‰",
  words: (n: number, max: number) => `è¯æ•°ï¼š${n} / ${max}`,

  pocketsTitle: "3) æœ‰å£è¢‹å—ï¼Ÿ",
  yes: "æœ‰",
  no: "æ²¡æœ‰",

  measuresTitle: "4) å°ºå¯¸ï¼ˆå¯é€‰ï¼‰",
  measuresHint: "å¯ä½¿ç”¨ cmï¼Œä¾‹å¦‚ï¼š52cm",

  modelTitle: "5) æ¨¡ç‰¹ç±»åž‹",
  ethnicityTitle: "6) äººç§/è‚¤è‰²",
  ageTitle: "7) å¹´é¾„",
  chooseModelFirst: "è¯·å…ˆé€‰æ‹©æ¨¡ç‰¹ç±»åž‹",
  poseTitle: "9) å§¿åŠ¿",
  bodyTypeTitle: "ä½“åž‹",

  faceTitle: "é¢éƒ¨ï¼ˆå¯é€‰ï¼‰",
  faceHint1: "âœ… ä¸Šä¼ é¢éƒ¨åŽï¼Œæˆ‘ä»¬ä¼šå°½é‡åœ¨æ‰€æœ‰å›¾ç‰‡ä¸­ä¿æŒåŒä¸€å¼ è„¸ã€‚",
  faceHint2: "âš ï¸ è‹¥ä¸ä¸Šä¼ ï¼Œç”Ÿæˆçš„å›¾ç‰‡å¯èƒ½ä¼šå‡ºçŽ°ä¸åŒçš„è„¸ã€‚",
  takeFacePhoto: "ðŸ“· æ‹æ‘„é¢éƒ¨ç…§ç‰‡",
  pickFaceGallery: "ðŸ–¼ï¸ é€‰æ‹©é¢éƒ¨ç…§ç‰‡",
  genFace: "âœ¨ ç”Ÿæˆé¢éƒ¨",
  genFaceLoading: "æ­£åœ¨ç”Ÿæˆé¢éƒ¨...",
  missingDataForFace: "ç”Ÿæˆé¢éƒ¨å‰è¯·å…ˆé€‰æ‹©æ¨¡ç‰¹ç±»åž‹ã€äººç§/è‚¤è‰²å’Œå¹´é¾„ã€‚",

  backgroundTitle: "8) èƒŒæ™¯ï¼ˆæœ€å¤š 10 ä¸ªè¯ï¼‰",
  helpChoosePlace: "å¸®æˆ‘æŽ¨è",
  searching: "æœç´¢ä¸­...",
  sceneTitle: "äº§å“åœºæ™¯ï¼ˆæœ€å¤š 10 ä¸ªè¯ï¼‰",
  helpChoose: "å¸®æˆ‘æŽ¨è",
  modelNewborn: "æ–°ç”Ÿå„¿",
  modelBoy: "ç”·å­©",
  modelGirl: "å¥³å­©",
  modelMan: "ç”·",
  modelWoman: "å¥³",
  generateTitle: "11) ç”Ÿæˆå›¾ç‰‡",
  summary: "æ‘˜è¦",
  uploadedPhotos: "å·²ä¸Šä¼ çš„ç…§ç‰‡",
  viewsToGenerate: "ä½ æƒ³ç”Ÿæˆå“ªäº›è§†è§’ï¼Ÿ",
  creditsToConsume: (n: number) => `å°†æ¶ˆè€—ç§¯åˆ†ï¼š${n}`,
  generate: (n: number) => `ç”Ÿæˆï¼ˆ${n} ç§¯åˆ†ï¼‰`,
  chooseAtLeastOneView: "è¯·è‡³å°‘é€‰æ‹© 1 ä¸ªè§†è§’",
  insufficientCredits: (n: number) => `ç§¯åˆ†ä¸è¶³ï¼ˆ${n}ï¼‰`,
  generating: "ç”Ÿæˆä¸­...",
  result: "ç»“æžœ",
  download: "â¬‡ï¸ ä¸‹è½½",
  redo: "ðŸ” é‡æ–°ç”Ÿæˆï¼ˆ1 ç§¯åˆ†ï¼‰",
  noCreditsRedo: "ç§¯åˆ†ä¸è¶³ï¼ˆ1ï¼‰",
  redoing: (sec: number) => `é‡æ–°ç”Ÿæˆä¸­...ï¼ˆ${sec}sï¼‰`,

  vFront: "æ­£é¢å…¨èº«",
  vBack: "èƒŒé¢å…¨èº«",
  vSide: "ä¾§é¢å…¨èº«",
  vFrontDetail: "æ­£é¢ç»†èŠ‚",
  vBackDetail: "èƒŒé¢ç»†èŠ‚",
  vPantFrontDetail: "è£¤å­ç»†èŠ‚ï¼ˆæ­£é¢ï¼‰",
  vPantBackDetail: "è£¤å­ç»†èŠ‚ï¼ˆèƒŒé¢ï¼‰",
  vPantSideDetail: "è£¤å­ç»†èŠ‚ï¼ˆä¾§é¢ï¼‰",

  pFront: "ä¸»å›¾",
  pBack: "æ›¿ä»£è§’åº¦",
  pLeft: "è¿‘æ™¯ç»†èŠ‚",
  pRight: "å…¶ä»–è§’åº¦",

  regenOverlayTitle: "ðŸ” æ­£åœ¨é‡æ–°ç”Ÿæˆâ€¦",
  regenOverlayHint: "è¯·ä¸è¦å…³é—­æˆ–åˆ·æ–°é¡µé¢ã€‚",

  topupOk: "âœ… ç§¯åˆ†å·²æˆåŠŸæ·»åŠ ",
  topupFail: "âŒ æ”¯ä»˜è¢«æ‹’ç»",

  history: "äº¤æ˜“è®°å½•",
  packEntrepreneur: "ðŸš€ åˆ›ä¸šè€…å¥—é¤ â€” 50 ç§¯åˆ† / $75,000",
  packPyme: "ðŸ¢ ä¸­å°ä¼ä¸šå¥—é¤ â€” 100 ç§¯åˆ† / $150,000",
  packEnterprise: "ðŸ“ˆ ä¼ä¸šå¥—é¤ â€” 200 ç§¯åˆ† / $300,000",
  noMovements: "æš‚æ— è®°å½•",
  date: "æ—¥æœŸ",
  movement: "ç±»åž‹",
  amount: "æ•°é‡",
  expired: "å·²è¿‡æœŸ",
  purchase: "è´­ä¹°",
  refund: "é€€æ¬¾",
  grant: "èµ é€",
  consumeModel: "ðŸ“¸ ä½¿ç”¨",
  consumeProduct: "âš›ï¸ ä½¿ç”¨",
  consumeGeneric: "ä½¿ç”¨",

  errUploadFront: "è¯·ä¸Šä¼ æ­£é¢ç…§ç‰‡ï¼ˆå¿…å¡«ï¼‰ã€‚",
  errUploadProduct: "è¯·è‡³å°‘ä¸Šä¼  1 å¼ äº§å“ç…§ç‰‡ã€‚",
  errChooseCategory: "è¯·é€‰æ‹©ä¸€ä¸ªç±»åˆ«ã€‚",
  errOtherMissing: "è¯·å¡«å†™â€œå…¶ä»–â€ï¼ˆæœ€å¤š 4 ä¸ªè¯ï¼‰ã€‚",
  errOtherTooLong: "â€œå…¶ä»–â€æœ€å¤š 4 ä¸ªè¯ã€‚",
  errPockets: "è¯·é€‰æ‹©æ˜¯å¦æœ‰å£è¢‹ï¼ˆæœ‰/æ²¡æœ‰ï¼‰ã€‚",
  errSceneMissing: "è¯·è¾“å…¥åœºæ™¯ï¼ˆæœ€å¤š 10 ä¸ªè¯ï¼‰ã€‚",
  errSceneTooLong: "åœºæ™¯æœ€å¤š 10 ä¸ªè¯ã€‚",
  errModel: "è¯·é€‰æ‹©æ¨¡ç‰¹ç±»åž‹ã€‚",
  errEthnicity: "è¯·é€‰æ‹©äººç§/è‚¤è‰²ã€‚",
  errAge: "è¯·é€‰æ‹©å¹´é¾„ã€‚",
  errPose: "è¯·é€‰æ‹©å§¿åŠ¿ã€‚",
  errBodyType: "è¯·é€‰æ‹©ä½“åž‹ã€‚",
  errBgMissing: "è¯·è¾“å…¥èƒŒæ™¯ï¼ˆæœ€å¤š 10 ä¸ªè¯ï¼‰ã€‚",
  errBgTooLong: "èƒŒæ™¯æœ€å¤š 10 ä¸ªè¯ã€‚",

  bonusExpiresIn: (hh: string, mm: string, ss: string) => `ðŸŽ 3 ç§¯åˆ†å¥–åŠ± â€” å°†åœ¨ ${hh}:${mm}:${ss} åŽè¿‡æœŸ`,
  whatsapp: "WhatsApp",
  whatsappPrefill: "ä½ å¥½ï¼Œæˆ‘éœ€è¦ç”Ÿæˆå™¨çš„å¸®åŠ©",
  missingApiBase: "Missing NEXT_PUBLIC_API_BASE in .env.local",
  missingApiUrl: "Missing NEXT_PUBLIC_API_URL in .env.local",
} as any,
} as const;


  function handleLogout() {
    localStorage.removeItem("accessToken");
    setUser(null);
    setAccessToken(null);
    setBalance(0);
  }

  


  React.useEffect(() => {
    const calc = () => setIsMobile(window.innerWidth < 640);
    calc();
    window.addEventListener("resize", calc);
    return () => window.removeEventListener("resize", calc);
  }, []);

  React.useEffect(() => {
    const url = new URL(window.location.href);
    const status = url.searchParams.get("topup");
    if (status) {
      setTopupStatus(status);
      fetchMe();
      window.history.replaceState({}, "", "/");
      const timer = window.setTimeout(() => setTopupStatus(null), 5000);
      return () => window.clearTimeout(timer);
    }
  }, []);

  const [mode, setMode] = useState<"model" | "product">("model");

  

  // files
  const [frontFile, setFrontFile] = useState<File | null>(null);
  const [backFile, setBackFile] = useState<File | null>(null);
  const [faceFile, setFaceFile] = useState<File | null>(null); // ðŸ‘ˆ NUEVO (rostro opcional)
  const [productFiles, setProductFiles] = useState<File[]>([]);

  // refs rostro
  const faceCameraRef = React.useRef<HTMLInputElement | null>(null);
  const faceGalleryRef = React.useRef<HTMLInputElement | null>(null);

  const [faceGenLoading, setFaceGenLoading] = useState(false);
  
  // ===== PREVIEWS (con cleanup para no filtrar memoria) =====
const frontPreview = useMemo(() => (frontFile ? URL.createObjectURL(frontFile) : null), [frontFile]);
React.useEffect(() => {
  return () => {
    if (frontPreview) URL.revokeObjectURL(frontPreview);
  };
}, [frontPreview]);

const backPreview = useMemo(() => (backFile ? URL.createObjectURL(backFile) : null), [backFile]);
React.useEffect(() => {
  return () => {
    if (backPreview) URL.revokeObjectURL(backPreview);
  };
}, [backPreview]);

const facePreview = useMemo(() => (faceFile ? URL.createObjectURL(faceFile) : null), [faceFile]);
React.useEffect(() => {
  return () => {
    if (facePreview) URL.revokeObjectURL(facePreview);
  };
}, [facePreview]);


const productPreviews = useMemo(
  () => productFiles.map((f) => ({ file: f, url: URL.createObjectURL(f) })),
  [productFiles]
);
React.useEffect(() => {
  return () => {
    productPreviews.forEach((p) => URL.revokeObjectURL(p.url));
  };
}, [productPreviews]);

  // form
  type CategoryValue = (typeof CATEGORIES)[number]["value"];
const [category, setCategory] = useState<CategoryValue | "">("");
  React.useEffect(() => {
  if (category !== "bottom") {
    setViews((prev) => ({
      ...prev,
      pantFrontDetail: false,
      pantBackDetail: false,
      pantSideDetail: false,
    }));
  }
}, [category]);

  const [otherCategory, setOtherCategory] = useState("");
  const [pockets, setPockets] = useState<"si" | "no" | "">("");
  const [measures, setMeasures] = useState({
    hombros: "",
    pecho: "",
    manga: "",
    cintura: "",
    cadera: "",
    largo: "",
  });

  // Google button init
  React.useEffect(() => {
    const interval = setInterval(() => {
      if (!(window as any).google) return;
      clearInterval(interval);

      const GOOGLE_CLIENT_ID =
        "177285831628-o6shn4e85ecub5jilj6tj02njbt9r6jf.apps.googleusercontent.com";

      (window as any).google.accounts.id.initialize({
        client_id: GOOGLE_CLIENT_ID,
        callback: async (response: any) => {
          try {
            const res = await fetch(`${API}/auth/google`, {
            method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ idToken: response.credential }),
            });

            const data = await res.json();
            if (!res.ok) throw new Error(data?.error || "Login error");

            setUser(data.user);
            setAccessToken(data.accessToken);
            localStorage.setItem("accessToken", data.accessToken);
            setBalance(data?.wallet?.balance ?? 0);

            await fetchMe();
            await fetchEntries();
          } catch (err: any) {
            console.error(err);
            alert(`Error login Google: ${err?.message || err}`);
          }
        },
        ux_mode: "popup",
        auto_select: false,
      });

      const el = document.getElementById("googleLoginDiv");
      if (el) {
        el.innerHTML = "";
        (window as any).google.accounts.id.renderButton(el, {
          theme: "outline",
          size: "large",
        });
      }
    }, 300);

    return () => clearInterval(interval);
  }, [API]);

  React.useEffect(() => {
    if (user || accessToken) return;
    const w = window as any;
    if (!w.google?.accounts?.id) return;
    const el = document.getElementById("googleLoginDiv");
    if (!el) return;
    el.innerHTML = "";
    w.google.accounts.id.renderButton(el, { theme: "outline", size: "large" });
  }, [user, accessToken]);

  type ModelTypeValue = (typeof MODEL_TYPES)[number]["value"];
const [modelType, setModelType] = useState<ModelTypeValue | "">("");
  type EthnicityValue = (typeof ETHNICITIES)[number]["value"];
const [ethnicity, setEthnicity] = useState<EthnicityValue | "">("");
  const [ageRange, setAgeRange] = useState("");
  const [background, setBackground] = useState("");
  const [scene, setScene] = useState("");
  type PoseValue = (typeof POSES)[number]["value"];
const [pose, setPose] = useState<PoseValue | "">("");
  type BodyTypeValue = (typeof BODY_TYPES)[number]["value"];
const [bodyType, setBodyType] = useState<BodyTypeValue | "">("");

  // ui
  const [step, setStep] = useState(0);
  const [loading, setLoading] = useState(false);
  const [helpLoading, setHelpLoading] = useState(false);
  const [bgSuggestions, setBgSuggestions] = useState<string[]>([]);
  const [error, setError] = useState<string | null>(null);

  const [result, setResult] = useState<{ imageUrls: string[]; promptUsed?: string } | null>(null);

 const isRegenBusy = useMemo(
  () => Object.values(regenLoading).some(Boolean),
  [regenLoading]
);


  const [bonusTick, setBonusTick] = useState(0);

React.useEffect(() => {
  const id = window.setInterval(() => setBonusTick((n) => n + 1), 1000);
  return () => window.clearInterval(id);
}, []);

  const [nowTick, setNowTick] = useState(0);
  React.useEffect(() => {
    if (!isRegenBusy) return;
    const id = window.setInterval(() => setNowTick((n) => n + 1), 1000);
    return () => window.clearInterval(id);
  }, [isRegenBusy]);

  React.useEffect(() => {
    try {
      if (!result) {
        localStorage.removeItem(LAST_RESULT_KEY);
        return;
      }
      const payload = { result, resultKeys, mode, savedAt: Date.now() };
      localStorage.setItem(LAST_RESULT_KEY, JSON.stringify(payload));
    } catch {}
  }, [result, resultKeys, mode]);

  const selectedCount = useMemo(() => Object.values(views).filter(Boolean).length, [views]);
  const creditsNeeded = selectedCount;
  const hasSelection = creditsNeeded > 0;

 const ageOptions = useMemo(() => {
  if (modelType === "newborn") return ["age_0_2"];
  if (modelType === "boy" || modelType === "girl") return ["age_3_6", "age_6_10", "age_10_16"];
  if (modelType === "man" || modelType === "woman") return ["age_18_24", "age_25_34", "age_35_44"];
  return [];
}, [modelType]);

 const steps = useMemo(() => {
  if (mode === "product") {
    return [
      { title: t("stepUpload"), key: "upload" },
      { title: t("stepScene"), key: "scene" },
      { title: t("stepGenerate"), key: "generate" },
    ];
  }

  return [
    { title: t("stepUpload"), key: "upload" },
    { title: t("stepCategory"), key: "category" },
    { title: t("stepPockets"), key: "pockets" },
    { title: t("stepMeasures"), key: "measures" },
    { title: t("stepModel"), key: "model" },
    { title: t("stepEthnicity"), key: "ethnicity" },
    { title: t("stepAge"), key: "age" },
    { title: t("stepFace"), key: "face" },
    { title: t("stepBackground"), key: "background" },
    { title: t("stepPose"), key: "pose" },
    { title: t("stepBodyType"), key: "bodyType" },
    { title: t("stepGenerate"), key: "generate" },
  ];
}, [mode, language]);

  React.useEffect(() => {
    // âœ… si estamos restaurando desde localStorage, NO borres el resultado
    if (hydratingRef.current) return;

    setScene("");
    setStep(0);
    setError(null);
    setResult(null);
    setFrontFile(null);
    setBackFile(null);
    setFaceFile(null);
    setCategory("");
    setOtherCategory("");
    setPockets("");
    setMeasures({
      hombros: "",
      pecho: "",
      manga: "",
      cintura: "",
      cadera: "",
      largo: "",
    });
    setModelType("");
    setEthnicity("");
    setAgeRange("");
    setBackground("");
    setPose("");
    setBodyType("");
    setBgSuggestions([]);
    setProductFiles([]);
    setViews({
  front: true,
  back: false,
  side: false,
  frontDetail: false,
  backDetail: false,
  pantFrontDetail: false,
  pantBackDetail: false,
  pantSideDetail: false,
  left: false,
  right: false,
});



  }, [mode]);

  React.useEffect(() => {
    fetchMe();
    fetchEntries();
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [API]);

  React.useEffect(() => {
    try {
      const raw = localStorage.getItem(LAST_RESULT_KEY);
      if (!raw) return;
      const parsed = JSON.parse(raw);
      if (!parsed?.result?.imageUrls?.length) return;

      // âœ… activamos flag para que el reset por mode no borre el result
      hydratingRef.current = true;

      // setMode primero (si aplica)
      if (parsed?.mode === "model" || parsed?.mode === "product") {
        setMode(parsed.mode);
      }

      // restaurar result y keys
      setResult(parsed.result);
      if (Array.isArray(parsed.resultKeys)) setResultKeys(parsed.resultKeys);

      // âœ… desactivar flag en el prÃ³ximo tick
      setTimeout(() => {
        hydratingRef.current = false;
      }, 0);
    } catch {}
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  const stepError = useMemo(() => {
    const key = steps[step]?.key;

    if (key === "upload") {
      if (mode === "product") return productFiles.length === 0 ? t("errUploadProduct") : null;
return !frontFile ? t("errUploadFront") : null;
    }

    if (key === "category") {
  if (!category) return t("errChooseCategory");

  if (category === "other") {
  if (!otherCategory.trim()) return t("errOtherMissing");
  if (wordCount(otherCategory) > 5) return t("errOtherTooLong");
}

  return null;
}

    if (key === "pockets") return pockets ? null : t("errPockets");
    if (key === "measures") return null;

    if (key === "scene") {
  if (!scene.trim()) return t("errSceneMissing");
  if (wordCount(scene) > 10) return t("errSceneTooLong");
  return null;
}

    if (key === "model") return modelType ? null : t("errModel");
    if (key === "ethnicity") return ethnicity ? null : t("errEthnicity");
    if (key === "age") return ageRange ? null : t("errAge");
    if (key === "pose") return pose ? null : t("errPose");
    if (key === "bodyType") return bodyType ? null : t("errBodyType");

    if (key === "background") {
  if (!background.trim()) return t("errBgMissing");
  if (wordCount(background) > 10) return t("errBgTooLong");
  return null;
}

    return null;
  }, [
    steps,
    step,
    mode,
    frontFile,
    productFiles,
    category,
    otherCategory,
    pockets,
    modelType,
    ethnicity,
    ageRange,
    background,
    pose,
    bodyType,
    scene,
  ]);

  const canGoNext = !stepError && !loading;
  const isLast = step === steps.length - 1;

  function next() {
    setError(null);
    if (!canGoNext) return;
    setStep((s) => Math.min(s + 1, steps.length - 1));
  }

  function prev() {
    setError(null);
    setStep((s) => Math.max(s - 1, 0));
  }

  function goToFirstErrorStep() {
    for (let i = 0; i < steps.length - 1; i++) {
      switch (i) {
        case 0:
          return setStep(0);

        case 1:
          if (!category) return setStep(1);
          if (category === "other" && (!otherCategory.trim() || wordCount(otherCategory) > 4)) return setStep(1);
          break;

        case 2:
          if (!pockets) return setStep(2);
          break;

        case 4:
          if (!modelType) return setStep(4);
          break;

        case 5:
          if (!ethnicity) return setStep(5);
          break;

        case 6:
          if (!ageRange) return setStep(6);
          break;

        case 7:
          if (!background.trim() || wordCount(background) > 10) return setStep(7);
          break;

        case 8:
          if (!pose) return setStep(8);
          break;

        case 9:
          if (!bodyType) return setStep(9);
          break;
      }
    }
  }

  async function fetchMe() {
    if (!API) return;
    const token = localStorage.getItem("accessToken");
    if (!token) return;

    setAccessToken(token);
    setLoadingMe(true);
    try {
      const res = await fetch(`${API}/auth/me`, {
        headers: { Authorization: `Bearer ${token}` },
      });
      const data = await res.json();
      if (!res.ok) return;
      setUser(data);
      setBalance(data?.wallet?.balance ?? 0);
    } finally {
      setLoadingMe(false);
    }
  }

  async function fetchEntries() {
    if (!API) return;
    const token = localStorage.getItem("accessToken");
    if (!token) return;

    setLoadingEntries(true);
    try {
      const res = await fetch(`${API}/wallet/entries`, {
        headers: { Authorization: `Bearer ${token}` },
      });
      const data = await res.json();
      if (!res.ok) return;
      const list = Array.isArray(data?.entries) ? data.entries : [];
setEntries(list);
setEntriesPage(1);
    } finally {
      setLoadingEntries(false);
    }
  }

  async function downloadImage(url: string, filename = "imagen.png") {
    try {
      const r = await fetch(url);
      const blob = await r.blob();
      const objectUrl = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = objectUrl;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(objectUrl);
    } catch {
      window.open(url, "_blank");
    }
  }

async function handleRegenerateOne(
  viewKey:
    | "front"
    | "back"
    | "side"
    | "frontDetail"
    | "backDetail"
    | "pantFrontDetail"
    | "pantBackDetail"
    | "pantSideDetail"
    | "left"
    | "right",
  index: number
) {




  setError(null);

  const lockKey = `regen:${index}`;

  // Si ya hay uno corriendo para ese Ã­ndice, no hagas nada
  if (regenLockRef.current[lockKey]) return;

  // Tomo el lock
  regenLockRef.current[lockKey] = true;

  // Helper para salir pero liberando lock
  const bail = (msg: string) => {
    setError(msg);
  };

  try {
    if (!API) {
      bail(t("missingApiBase"));
      return;
    }

    if (balance < 1) {
      bail(t("noCreditsRedo"));
      return;
    }

    // Validaciones mÃ­nimas
    if (mode === "product") {
      if (productFiles.length === 0) {
        bail(t("errUploadProduct"));
        return;
      }
      if (!scene.trim()) {
  bail(t("errSceneMissing"));
  return;
}
if (wordCount(scene) > 10) {
  bail(t("errSceneTooLong"));
  return;
}
    } else {
      if (!frontFile) {
  bail(t("errUploadFront"));
  return;
}
      if (!category) {
  bail(t("errChooseCategory"));
  return;
}
if (!pockets) {
  bail(t("errPockets"));
  return;
}
if (!modelType) {
  bail(t("errModel"));
  return;
}
if (!ethnicity) {
  bail(t("errEthnicity"));
  return;
}
if (!ageRange) {
  bail(t("errAge"));
  return;
}
if (!background.trim()) {
  bail(t("errBgMissing"));
  return;
}
if (wordCount(background) > 10) {
  bail(t("errBgTooLong"));
  return;
}
if (!pose) {
  bail(t("errPose"));
  return;
}
if (!bodyType) {
  bail(t("errBodyType"));
  return;
}
    }

    // Ahora sÃ­: marcamos loading
    setRegenLoading((m) => ({ ...m, [lockKey]: true }));
    setRegenStartedAt((m) => ({ ...m, [lockKey]: Date.now() }));

   const oneView = { front: false, back: false, [viewKey]: true };


    const fd = new FormData();
    fd.append("mode", mode);
    fd.append("views", JSON.stringify(oneView));
    fd.append("language", language);
    fd.append("regen_variation", String(Date.now()));
    fd.append("regen_variation", String(Date.now()));

    if (mode === "product") {
      appendProductFormData(fd);
    } else {
      appendModelFormData(fd);
    }

    const token = localStorage.getItem("accessToken");
    console.log("=== FORM DATA DEBUG ===");
for (const [k, v] of fd.entries()) {
  if (v instanceof File) {
    console.log(k, `File(name=${v.name}, size=${v.size}, type=${v.type})`);
  } else {
    console.log(k, v);
  }
}
console.log("=== END FORM DATA DEBUG ===");
    const res = await fetch(`${API}/generate`, {
      method: "POST",
      headers: token ? { Authorization: `Bearer ${token}` } : undefined,
      body: fd,
    });

    const data = await res.json().catch(() => ({}));
    if (!res.ok) throw new Error(data?.error || data?.message || "Error rehaciendo");

    let url = "";
    if (Array.isArray(data?.imageUrls) && data.imageUrls[0]) url = data.imageUrls[0];
    else if (typeof data?.imageUrl === "string") url = data.imageUrl;
    if (!url) throw new Error("El servidor no devolviÃ³ imagen.");

    const absolute = url.startsWith("http") ? url : `${API}${url.startsWith("/") ? "" : "/"}${url}`;

    setResult((prev) => {
      if (!prev) return prev;
      const copy = [...prev.imageUrls];
      copy[index] = absolute;
      return { ...prev, imageUrls: copy };
    });

    void fetchMe();
void fetchEntries();

  } catch (e: any) {
    setError(String(e?.message || e));
  } finally {
    // âœ… esperar 2 frames para que el <img> pinte antes de sacar el overlay
    setTimeout(() => {
  setRegenLoading((m) => {
    const copy = { ...m };
    delete copy[lockKey];
    return copy;
  });

  setRegenStartedAt((m) => {
    const copy = { ...m };
    delete copy[lockKey];
    return copy;
  });

  delete regenLockRef.current[lockKey];
}, 80);
  }
}


  async function handleSuggestBackground() {
    setError(null);
    if (!API) return setError(t("missingApiBase"));
    setHelpLoading(true);
    setBgSuggestions([]);

    try {
      const fd = new FormData();
fd.append("category", category || "");
fd.append("model_type", modelType || "");
fd.append("vibe", "catÃ¡logo e-commerce premium");
fd.append("language", language);

if (frontFile) fd.append("front", frontFile); // ðŸ‘ˆ clave

const res = await fetch(`${API}/suggest-background`, {
  method: "POST",
  body: fd,
});

      const data = await res.json();
      const options: string[] = Array.isArray(data?.options) ? data.options : [];
      setBgSuggestions(options.slice(0, 3));
    } catch (e: any) {
      setError(`Error sugiriendo fondo: ${String(e?.message || e)}`);
    } finally {
      setHelpLoading(false);
    }
  }

  async function handleGenerate() {
  setError(null);
  setResult(null);

  if (!API) return setError(t("missingApiBase"));

  // Validaciones
  if (mode === "product") {
    if (productFiles.length === 0) {
      setStep(0);
      return setError(t("errUploadProduct"));
    }
    if (!scene.trim()) {
      setStep(1);
      return setError(t("errSceneMissing"));
    }
    if (wordCount(scene) > 10) {
      setStep(1);
      return setError(t("errSceneTooLong"));
    }
    if (selectedCount === 0) {
      setStep(2);
      return setError(t("chooseAtLeastOneView"));
    }
  } else {
    if (!frontFile) return (goToFirstErrorStep(), setError(t("errUploadFront")));
    if (!category) return (goToFirstErrorStep(), setError(t("errChooseCategory")));
    if (category === "other") {
      if (!otherCategory.trim()) return (goToFirstErrorStep(), setError(t("errOtherMissing")));
      if (wordCount(otherCategory) > 4) return (goToFirstErrorStep(), setError(t("errOtherTooLong")));
    }
    if (!pockets) return (goToFirstErrorStep(), setError(t("errPockets")));
    if (!modelType) return (goToFirstErrorStep(), setError(t("errModel")));
    if (!ethnicity) return (goToFirstErrorStep(), setError(t("errEthnicity")));
    if (!ageRange) return (goToFirstErrorStep(), setError(t("errAge")));
    if (!background.trim()) return (goToFirstErrorStep(), setError(t("errBgMissing")));
    if (wordCount(background) > 10) return (goToFirstErrorStep(), setError(t("errBgTooLong")));
    if (!pose) return (goToFirstErrorStep(), setError(t("errPose")));
    if (!bodyType) return (goToFirstErrorStep(), setError(t("errBodyType")));
  }

  const keysInOrder =
    mode === "product"
      ? (["front", "back", "left", "right"] as const).filter((k) => (views as any)[k])
      : ([
          "front",
          "back",
          "side",
          "frontDetail",
          "backDetail",
          "pantFrontDetail",
          "pantBackDetail",
          "pantSideDetail",
        ] as const).filter((k) => (views as any)[k]);

  setResultKeys(keysInOrder as any);

  setLoading(true);
  try {
    const fd = new FormData();
    fd.append("mode", mode);
    console.log("DEBUG FRONTEND views:", views);
    fd.append("views", JSON.stringify(views));
    fd.append("language", language);

    if (mode === "product") appendProductFormData(fd);
    else appendModelFormData(fd);

    const token = localStorage.getItem("accessToken");
    const res = await fetch(`${API}/generate`, {
      method: "POST",
      headers: token ? { Authorization: `Bearer ${token}` } : undefined,
      body: fd,
    });

    const text = await res.text();
    let data: any = null;
    try {
      data = JSON.parse(text);
    } catch {
      data = { raw: text };
    }

    if (!res.ok) {
      setError(data?.error || data?.message || `Error ${res.status}: ${String(text).slice(0, 200)}`);
      return;
    }

    let urls: string[] = [];
    if (Array.isArray(data?.imageUrls)) urls = data.imageUrls;
    else if (typeof data?.imageUrl === "string") urls = [data.imageUrl];

    if (!urls.length) {
      setError("El servidor no devolviÃ³ imÃ¡genes.");
      return;
    }

    const absolute = urls.map((u) => (u.startsWith("http") ? u : `${API}${u.startsWith("/") ? "" : "/"}${u}`));
    if (Array.isArray(data?.imageKeys)) {
  setResultKeys(data.imageKeys);
}
    setResult({ imageUrls: absolute, promptUsed: data?.promptUsed });

    await fetchMe();
    await fetchEntries();

    
  } catch (e: any) {
    setError(String(e?.message || e));
  } finally {
    setLoading(false);
  }
}
  // ============ RENDER PANEL POR PASO ============
  const panel = useMemo(() => {
    switch (steps[step].key) {
      case "upload":
        return (
          <>
            <FieldTitle>{t("uploadTitle")}</FieldTitle>

            {mode === "product" ? (
              <Box>
                <Label>{t("productPhotosLabel")}</Label>

                {/* Inputs ocultos */}
                <input
                  ref={cameraInputRef}
                  type="file"
                  accept="image/*"
                  capture="environment"
                  onChange={(e) => {
                    const files = Array.from(e.target.files || []);
                    addProductFiles(files);
                    e.currentTarget.value = "";
                  }}
                  style={{ display: "none" }}
                />
                <input
                  ref={galleryInputRef}
                  type="file"
                  accept="image/*"
                  multiple
                  onChange={(e) => {
                    const files = Array.from(e.target.files || []);
                    addProductFiles(files);
                    e.currentTarget.value = "";
                  }}
                  style={{ display: "none" }}
                />

                <div style={{ display: "grid", gap: 10, marginTop: 10 }}>
                  <button
                    type="button"
                    onClick={() => cameraInputRef.current?.click()}
                    style={{
                      ...styles.buyBtnFull,
                      height: 44,
                      boxShadow: "0 8px 20px rgba(34,197,94,0.22)",
                      background: "linear-gradient(135deg, #22c55e 0%, #16a34a 100%)",
                    }}
                  >
                    {t("takePhoto")}
                  </button>

                  <button
                    type="button"
                    onClick={() => galleryInputRef.current?.click()}
                    style={{
                      ...styles.logoutBtnFull,
                      height: 44,
                      background: "#ffffff",
                      border: "1px solid #e2e8f0",
                    }}
                  >
                    {t("pickFromGallery")}
                  </button>
                </div>

                {productFiles.length > 0 && (
                  <SmallMuted style={{ marginTop: 10 }}>
  {t("photosLoaded", productFiles.length)}
</SmallMuted>
                )}
                {productPreviews.length > 0 && (
  <div style={{ marginTop: 12 }}>
    <div style={{ fontWeight: 900, marginBottom: 10, color: "#0f172a" }}>
  {t("preview")}
</div>

    <div style={styles.previewGridCompact}>
      {productPreviews.map((p, i) => (
        <div key={`${p.file.name}-${p.file.size}-${p.file.lastModified}`} style={{ ...styles.previewCard, position: "relative" }}>
          <img src={p.url} alt={`producto-${i}`} 
          style={styles.previewImgCompact} />

          <button
            type="button"
            onClick={() => removeProductFile(i)}
            style={{
              position: "absolute",
              top: 8,
              right: 8,
              width: 34,
              height: 34,
              borderRadius: 999,
              border: "1px solid rgba(15,23,42,0.12)",
              background: "rgba(15,23,42,0.85)",
              color: "#ffffff",
              fontWeight: 900,
              cursor: "pointer",
            }}
            aria-label="Quitar imagen"
            title="Quitar"
          >
            âœ•
          </button>
        </div>
      ))}
    </div>
  </div>
)}
              </Box>
            ) : (
              <TwoCols>
                {/* DELANTERA */}
                <Box>
                  <Label>{t("frontRequired")}</Label>

                  <input
                    ref={frontCameraRef}
                    type="file"
                    accept="image/*"
                    capture="environment"
                    onChange={(e) => {
                      setFrontFile(e.target.files?.[0] || null);
                      e.currentTarget.value = "";
                    }}
                    style={{ display: "none" }}
                  />
                  <input
                    ref={frontGalleryRef}
                    type="file"
                    accept="image/*"
                    onChange={(e) => {
                      setFrontFile(e.target.files?.[0] || null);
                      e.currentTarget.value = "";
                    }}
                    style={{ display: "none" }}
                  />

                  <div style={{ display: "grid", gap: 10, marginTop: 10 }}>
                    <button
                      type="button"
                      onClick={() => frontCameraRef.current?.click()}
                      style={{
                        ...styles.buyBtnFull,
                        height: 44,
                        boxShadow: "0 8px 20px rgba(34,197,94,0.22)",
                        background: "linear-gradient(135deg, #22c55e 0%, #16a34a 100%)",
                      }}
                    >
                       {t("takePhoto")}
                    </button>

                    <button
                      type="button"
                      onClick={() => frontGalleryRef.current?.click()}
                      style={{
                        ...styles.logoutBtnFull,
                        height: 44,
                        background: "#ffffff",
                        border: "1px solid #e2e8f0",
                      }}
                    >
                      {t("pickFromGallery")}
                    </button>
                  </div>

                  {frontFile && (
  <div style={{ marginTop: 12 }}>
    <div style={{ ...styles.previewCard, position: "relative" }}>
      <img src={frontPreview || ""} alt={t("frontRequired")} style={styles.previewImg} />
      <button
        type="button"
        onClick={() => setFrontFile(null)}
       style={{
  position: "absolute",
  top: 10,
  right: 10,
  width: 32,
  height: 32,
  borderRadius: 999,
  border: "1px solid rgba(15,23,42,0.15)",
  background: "rgba(255,255,255,0.95)",
  color: "#0f172a",
  fontWeight: 900,
  fontSize: 16,
  display: "grid",
  placeItems: "center",
  cursor: "pointer",
  boxShadow: "0 10px 18px rgba(15,23,42,0.08)",
}}
        aria-label="Quitar delantera"
        title="Quitar"
      >
        âœ•
      </button>
    </div>

    <SmallMuted style={{ marginTop: 8 }}>{frontFile.name}</SmallMuted>
  </div>
)}
                </Box>

                {/* ESPALDA */}
                <Box>
                  <Label>{t("backOptional")}</Label>

                  <input
                    ref={backCameraRef}
                    type="file"
                    accept="image/*"
                    capture="environment"
                    onChange={(e) => {
                      setBackFile(e.target.files?.[0] || null);
                      e.currentTarget.value = "";
                    }}
                    style={{ display: "none" }}
                  />
                  <input
                    ref={backGalleryRef}
                    type="file"
                    accept="image/*"
                    onChange={(e) => {
                      setBackFile(e.target.files?.[0] || null);
                      e.currentTarget.value = "";
                    }}
                    style={{ display: "none" }}
                  />

                  <div style={{ display: "grid", gap: 10, marginTop: 10 }}>
                    <button
                      type="button"
                      onClick={() => backCameraRef.current?.click()}
                      style={{
                        ...styles.buyBtnFull,
                        height: 44,
                        boxShadow: "0 8px 20px rgba(34,197,94,0.22)",
                        background: "linear-gradient(135deg, #22c55e 0%, #16a34a 100%)",
                      }}
                    >
                      {t("takePhoto")}
                    </button>

                    <button
                      type="button"
                      onClick={() => backGalleryRef.current?.click()}
                      style={{
                        ...styles.logoutBtnFull,
                        height: 44,
                        background: "#ffffff",
                        border: "1px solid #e2e8f0",
                      }}
                    >
                      {t("pickFromGallery")}
                    </button>
                  </div>

                  {backFile && (
  <div style={{ marginTop: 12 }}>
    <div style={{ ...styles.previewCard, position: "relative" }}>
      <img src={backPreview || ""} alt={t("backOptional")} style={styles.previewImg} />
      <button
        type="button"
        onClick={() => setBackFile(null)}
        style={{
  position: "absolute",
  top: 10,
  right: 10,
  width: 32,
  height: 32,
  borderRadius: 999,
  border: "1px solid rgba(15,23,42,0.15)",
  background: "rgba(255,255,255,0.95)",
  color: "#0f172a",
  fontWeight: 900,
  fontSize: 16,
  display: "grid",
  placeItems: "center",
  cursor: "pointer",
  boxShadow: "0 10px 18px rgba(15,23,42,0.08)",
}}
        aria-label="Quitar espalda"
        title="Quitar"
      >
        âœ•
      </button>
    </div>

    <SmallMuted style={{ marginTop: 8 }}>{backFile.name}</SmallMuted>
  </div>
)}
                </Box>
              </TwoCols>
            )}
          </>
        );

      case "category":
        return (
          <>
            <FieldTitle>{t("categoryTitle")}</FieldTitle>

            <div style={isMobile ? styles.pillsGrid2Mobile : styles.pillsGrid2}>
              {CATEGORIES.map((c) => (
  <button
    key={c.value}
    type="button"
    onClick={() => setCategory(c.value as any)}
    style={{
      ...styles.pill,
      ...(isMobile ? styles.pillMobile : {}),
      ...(category === c.value ? styles.pillActive : {}),
    }}
  >
    {t(c.labelKey)}
  </button>
))}
            </div>

            {category === "other" && (
              <div style={{ marginTop: 12 }}>
                <Label>{t("otherSpecify")}</Label>
                <TextInput
  value={otherCategory}
  onChange={setOtherCategory}
  placeholder={t("otherExample")}
/>
                <SmallMuted>
  {t("words", wordCount(otherCategory), 5)}
</SmallMuted>
              </div>
            )}
          </>
        );

      case "pockets":
        return (
          <>
            <FieldTitle>{t("pocketsTitle")}</FieldTitle>
            <RadioPills
              value={pockets}
              onChange={(v) => setPockets(v as any)}
              options={[
  { value: "si", label: t("yes") },
  { value: "no", label: t("no") },
]}
            />
          </>
        );

      case "measures":
        return (
          <>
            <FieldTitle>{t("measuresTitle")}</FieldTitle>
            <SmallMuted>{t("measuresHint")}</SmallMuted>

            <Grid3>
              {Object.entries(measures).map(([k, v]) => (
                <div key={k}>
                  <Label>{t(`m_${k}`)}</Label>
<TextInput
  value={v}
  onChange={(nv) => setMeasures((m) => ({ ...m, [k]: nv }))}
  placeholder={t("exampleCm")}
/>
                </div>
              ))}
            </Grid3>
          </>
        );

      case "model":
  return (
    <>
      <FieldTitle>{t("modelTitle")}</FieldTitle>
      <RadioPills
  value={modelType}
  onChange={(v) => {
    setModelType(v as any);
    setAgeRange("");
  }}
  options={MODEL_TYPES.map((m) => ({
    value: m.value,
    label: t(m.labelKey),
  }))}
/>
    </>
  );

  {faceFile && (
    <div style={{ marginTop: 12 }}>
      <div style={{ ...styles.previewCard, position: "relative" }}>
        <img src={facePreview || ""} alt="rostro" style={styles.previewImg} />
        <button
          type="button"
          onClick={() => setFaceFile(null)}
          style={{
            position: "absolute",
            top: 10,
            right: 10,
            width: 32,
            height: 32,
            borderRadius: 999,
            border: "1px solid rgba(15,23,42,0.15)",
            background: "rgba(255,255,255,0.95)",
            color: "#0f172a",
            fontWeight: 900,
            fontSize: 16,
            display: "grid",
            placeItems: "center",
            cursor: "pointer",
            boxShadow: "0 10px 18px rgba(15,23,42,0.08)",
          }}
          aria-label="Quitar rostro"
          title="Quitar"
        >
          âœ•
        </button>
      </div>

      <SmallMuted style={{ marginTop: 8 }}>{faceFile?.name}</SmallMuted>
    </div>
  )}

      case "ethnicity":
        return (
          <>
            <FieldTitle>{t("ethnicityTitle")}</FieldTitle>

            <div style={isMobile ? styles.pillsGrid2Mobile : styles.pillsGrid2}>
              {ETHNICITIES.map((e) => (
  <button
    key={e.value}
    type="button"
    onClick={() => setEthnicity(e.value as any)}
    style={{
      ...styles.pill,
      ...(isMobile ? styles.pillMobile : {}),
      ...(ethnicity === e.value ? styles.pillActive : {}),
    }}
  >
    {t(e.labelKey)}
  </button>
))}
            </div>
          </>
        );

      case "age":
  return (
    <>
      <FieldTitle>{t("ageTitle")}</FieldTitle>

      {!modelType ? (
        <SmallMuted>{t("chooseModelFirst")}</SmallMuted>
      ) : (
        <RadioPills
          value={ageRange}
          onChange={(v) => setAgeRange(v)}
          options={ageOptions.map((k) => ({ value: k, label: t(k) }))}
        />
      )}
    </>
  );

        case "face":
  return (
    <>
      <FieldTitle>{t("faceTitle")}</FieldTitle>

      <SmallMuted>
  {t("faceHint1")}
  <br />
  {t("faceHint2")}
</SmallMuted>

      {/* Inputs ocultos */}
      <input
        ref={faceCameraRef}
        type="file"
        accept="image/*"
        capture="user"
        onChange={(e) => {
          setFaceFile(e.target.files?.[0] || null);
          e.currentTarget.value = "";
        }}
        style={{ display: "none" }}
      />
      <input
        ref={faceGalleryRef}
        type="file"
        accept="image/*"
        onChange={(e) => {
          setFaceFile(e.target.files?.[0] || null);
          e.currentTarget.value = "";
        }}
        style={{ display: "none" }}
      />

      <div style={{ display: "grid", gap: 10, marginTop: 12 }}>
        <button
          type="button"
          onClick={() => faceCameraRef.current?.click()}
          style={{ ...styles.buyBtnFull, height: 44 }}
        >
          {t("takeFacePhoto")}
        </button>

        <button
          type="button"
          onClick={() => faceGalleryRef.current?.click()}
          style={{ ...styles.logoutBtnFull, height: 44, background: "#ffffff", border: "1px solid #e2e8f0" }}
        >
          {t("pickFromGallery")}
        </button>

        <button
          type="button"
          disabled={faceGenLoading || !modelType || !ethnicity || !ageRange}
          onClick={async () => {
            try {
              setError(null);
              if (!API) return setError("Falta NEXT_PUBLIC_API_URL en .env.local");

              if (!modelType || !ethnicity || !ageRange) {
                return setError("ElegÃ­ tipo de modelo, etnia y edad antes de generar el rostro.");
              }

              setFaceGenLoading(true);

              const token = localStorage.getItem("accessToken");
              const res = await fetch(`${API}/generate-face`, {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  ...(token ? { Authorization: `Bearer ${token}` } : {}),
                },
                body: JSON.stringify({
                  model_type: modelType,
                  ethnicity,
                  age_range: ageRange,
                  body_type: bodyType || "",
                }),
              });

              const data = await res.json().catch(() => ({}));
              if (!res.ok) throw new Error(data?.error || "Error generando rostro");

              const url = String(data?.imageUrl || "");
              if (!url) throw new Error("El servidor no devolviÃ³ imageUrl");

              const absolute = url.startsWith("http") ? url : `${API}${url.startsWith("/") ? "" : "/"}${url}`;

              const imgRes = await fetch(absolute);
              const blob = await imgRes.blob();
              const file = new File([blob], `face-${Date.now()}.png`, { type: blob.type || "image/png" });

              setFaceFile(file);
            } catch (e: any) {
              setError(String(e?.message || e));
            } finally {
              setFaceGenLoading(false);
            }
          }}
          style={{
            ...styles.buyBtnFull,
            height: 44,
            opacity: faceGenLoading || !modelType || !ethnicity || !ageRange ? 0.65 : 1,
            cursor: faceGenLoading || !modelType || !ethnicity || !ageRange ? "not-allowed" : "pointer",
            background: "linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",
          }}
        >
          {faceGenLoading ? t("genFaceLoading") : t("genFace")}
        </button>
      </div>

      {faceFile && (
        <div style={{ marginTop: 14 }}>
          <div style={{ ...styles.previewCard, position: "relative" }}>
            <img src={facePreview || ""} alt="rostro" style={styles.previewImg} />
            <button
              type="button"
              onClick={() => setFaceFile(null)}
              style={{
                position: "absolute",
                top: 10,
                right: 10,
                width: 32,
                height: 32,
                borderRadius: 999,
                border: "1px solid rgba(15,23,42,0.15)",
                background: "rgba(255,255,255,0.95)",
                color: "#0f172a",
                fontWeight: 900,
                fontSize: 16,
                display: "grid",
                placeItems: "center",
                cursor: "pointer",
                boxShadow: "0 10px 18px rgba(15,23,42,0.08)",
              }}
              aria-label="Quitar rostro"
              title="Quitar"
            >
              âœ•
            </button>
          </div>
        </div>
      )}
    </>
  );

      case "background":
        return (
          <>
            <FieldTitle>{t("backgroundTitle")}</FieldTitle>
            <TextInput value={background} onChange={setBackground} placeholder={t("bgPlaceholder")} />

            <Row style={{ marginTop: 10, justifyContent: "space-between" }}>
              <SmallMuted>
  {t("words", wordCount(background), 10)}
</SmallMuted>
              <Button variant="secondary" onClick={handleSuggestBackground} disabled={helpLoading || !category || !modelType}>
                {helpLoading ? t("searching") : t("helpChoosePlace")}
              </Button>
            </Row>

            {bgSuggestions.length > 0 && (
              <div style={{ marginTop: 12, display: "grid", gap: 8 }}>
                {bgSuggestions.map((s, i) => (
                  <button key={i} onClick={() => setBackground(s)} style={styles.suggestionBtn}>
                    {s}
                  </button>
                ))}
              </div>
            )}
          </>
        );

      case "pose":
        return (
          <>
            <FieldTitle>{t("poseTitle")}</FieldTitle>
            <RadioPills
  value={pose}
  onChange={(v) => setPose(v as any)}
  options={POSES.map((p) => ({
    value: p.value,
    label: t(p.labelKey),
  }))}
/>
          </>
        );

      case "bodyType":
        return (
          <>
            <FieldTitle>{t("bodyTypeTitle")}</FieldTitle>
            <RadioPills
  value={bodyType}
  onChange={(v) => setBodyType(v as any)}
  options={BODY_TYPES.map((b) => ({
    value: b.value,
    label: t(b.labelKey),
  }))}
/>
          </>
        );

      case "scene":
        return (
          <>
            <FieldTitle>{t("sceneTitle")}</FieldTitle>
            <TextInput
  value={scene}
  onChange={setScene}
  placeholder={t("scenePlaceholder")}
/>

            <Row style={{ marginTop: 10, justifyContent: "space-between" }}>
              <SmallMuted>{t("words", wordCount(scene), 10)}</SmallMuted>

              <Button
                variant="secondary"
                onClick={async () => {
                  if (!API) return setError("Falta NEXT_PUBLIC_API_BASE");
                  setHelpLoading(true);
                  try {
                    const fd = new FormData();
fd.append("category", category || "");
fd.append("model_type", modelType || "");
fd.append("vibe", "catÃ¡logo e-commerce premium");
fd.append("language", language);

if (mode === "product" && productFiles.length > 0) {
  fd.append("front", productFiles[0]); // usa la primera foto del producto
} else if (frontFile) {
  fd.append("front", frontFile); // modo model
}

const res = await fetch(`${API}/suggest-background`, {
  method: "POST",
  body: fd,
});
                    const data = await res.json();
                    if (Array.isArray(data?.options) && data.options.length > 0) setScene(data.options[0]);
                  } catch (err: any) {
                    setError(String(err?.message || err));
                  } finally {
                    setHelpLoading(false);
                  }
                }}
                disabled={helpLoading}
              >
                {helpLoading ? t("searching") : t("helpChoose")}
              </Button>
            </Row>
          </>
        );

      case "generate":
        return (
          <>
            <FieldTitle>{t("generateTitle")}</FieldTitle>

            <div style={styles.summaryCard}>
              <div style={styles.summaryTitle}>{t("summary")}</div>

              {/* ====== FOTOS PREVIEW ====== */}
              <div style={{ marginBottom: 14 }}>
                <div style={{ fontWeight: 900, marginBottom: 10 }}>
  {t("uploadedPhotos")}
</div>

                {mode === "product" ? (
                  <div style={styles.previewGrid}>
                    {productFiles.map((file, i) => (
                      <div key={i} style={styles.previewCard}>
                        <img src={URL.createObjectURL(file)} alt={`producto-${i}`} style={styles.previewImg} />
                      </div>
                    ))}
                  </div>
                ) : (
                  <div style={styles.previewGrid}>
                    {frontFile && (
                      <div style={styles.previewCard}>
                        <img src={URL.createObjectURL(frontFile)} alt="delantera" style={styles.previewImg} />
                      </div>
                    )}
                    {backFile && (
                      <div style={styles.previewCard}>
                        <img src={URL.createObjectURL(backFile)} alt="espalda" style={styles.previewImg} />
                      </div>
                    )}
                  </div>
                )}
              </div>

              {/* ====== DATOS ====== */}
              {mode === "product" ? (
                <div style={{ ...styles.summaryGrid, gridTemplateColumns: "1fr" }}>
                  <SummaryItem label={t("sceneLabel")} value={scene} />
                </div>
              ) : (
                <ModelSummary
  t={t}
  category={category}
  otherCategory={otherCategory}
  pockets={pockets}
  modelType={modelType}
  ethnicity={ethnicity}
  ageRange={ageRange}
  background={background}
  pose={pose}
  bodyType={bodyType}
  labelFromList={labelFromList}
  CATEGORIES={CATEGORIES}
  MODEL_TYPES={MODEL_TYPES}
  ETHNICITIES={ETHNICITIES}
  POSES={POSES}
  BODY_TYPES={BODY_TYPES}
  styles={styles}
/>
              )}
            </div>

            {mode === "product" ? (
              <div style={{ marginBottom: 14 }}>
                <div style={{ fontWeight: 900, marginBottom: 10, color: "rgba(255,255,255,0.85)" }}>
                  {t("viewsToGenerate")}
                </div>

                {[
  { key: "front", label: t("pFront") },
  { key: "back", label: t("pBack") },
  { key: "left", label: t("pLeft") },
  { key: "right", label: t("pRight") },
].map((v) => (
                  <label
                    key={v.key}
                    style={{
                      display: "flex",
                      alignItems: "center",
                      justifyContent: "space-between",
                      padding: "10px 12px",
                      borderRadius: 14,
                      border: "1px solid rgba(255,255,255,0.12)",
                      background: "rgba(255,255,255,0.06)",
                      marginBottom: 10,
                      cursor: "pointer",
                    }}
                  >
                    <span style={{ fontWeight: 800, color: "#ffffff" }}>{v.label}</span>
                    <input
                      type="checkbox"
                      checked={(views as any)[v.key]}
                      onChange={(e) => setViews((prev) => ({ ...prev, [v.key]: e.target.checked }))}
                      style={{ width: 18, height: 18 }}
                    />
                  </label>
                ))}

                <div style={{ color: "rgba(255,255,255,0.75)", fontSize: 12, fontWeight: 700 }}>
                  {t("creditsToConsume", selectedCount)}
                </div>
              </div>
            ) : (
              <div style={{ marginBottom: 14 }}>
                <div style={{ fontWeight: 900, marginBottom: 10, color: "rgba(255,255,255,0.85)" }}>
                  {t("viewsToGenerate")}
                </div>

                {[
  { key: "front", label: t("vFront") },
  { key: "back", label: t("vBack") },
  { key: "side", label: t("vSide") },
  { key: "frontDetail", label: t("vFrontDetail") },
  { key: "backDetail", label: t("vBackDetail") },
  ...(category === "bottom"
  ? [
      { key: "pantFrontDetail", label: t("vPantFrontDetail") },
      { key: "pantBackDetail", label: t("vPantBackDetail") },
      { key: "pantSideDetail", label: t("vPantSideDetail") },
    ]
  : []),
].map((v) => (
                  <label
                    key={v.key}
                    style={{
                      display: "flex",
                      alignItems: "center",
                      justifyContent: "space-between",
                      padding: "10px 12px",
                      borderRadius: 14,
                      border: "1px solid rgba(255,255,255,0.12)",
                      background: "rgba(255,255,255,0.06)",
                      marginBottom: 10,
                      cursor: "pointer",
                    }}
                  >
                    <span style={{ fontWeight: 800, color: "#ffffff" }}>{v.label}</span>
                    <input
                      type="checkbox"
                      checked={(views as any)[v.key]}
                      onChange={(e) => setViews((prev) => ({ ...prev, [v.key]: e.target.checked }))}
                      style={{ width: 18, height: 18 }}
                    />
                  </label>
                ))}

                <div style={{ color: "rgba(255,255,255,0.75)", fontSize: 12, fontWeight: 700 }}>
                  {t("creditsToConsume", selectedCount)}
                </div>
              </div>
            )}

            <Button
              onClick={handleGenerate}
              disabled={isRegenBusy || loading || selectedCount === 0 || balance < selectedCount}
              style={{ width: "100%", padding: "14px 16px" }}
            >
              {loading
  ? t("generating")
  : selectedCount === 0
  ? t("chooseAtLeastOneView")
  : balance < selectedCount
  ? t("insufficientCredits", selectedCount)
  : t("generate", selectedCount)}
            </Button>

            {result && (
              <div style={{ marginTop: 16 }}>
                <div style={{ fontWeight: 700, marginBottom: 10 }}>
  {t("result")}
</div>

                <div style={styles.resultGrid}>
                  {result.imageUrls.map((u, idx) => {
                    const viewKey = (resultKeys[idx] || "front") as
  | "front"
  | "back"
  | "side"
  | "frontDetail"
  | "backDetail"
  | "pantFrontDetail"
  | "pantBackDetail"
  | "pantSideDetail"
  | "left"
  | "right";





                    const loadKey = `regen:${idx}`;
                    void nowTick;

                    const label =
  mode === "product"
    ? viewKey === "front"
      ? t("pFront")
      : viewKey === "back"
      ? t("pBack")
      : viewKey === "left"
      ? t("pLeft")
      : viewKey === "right"
      ? t("pRight")
      : t("pFront")
    : viewKey === "front"
    ? t("vFront")
    : viewKey === "back"
    ? t("vBack")
    : viewKey === "side"
    ? t("vSide")
    : viewKey === "frontDetail"
    ? t("vFrontDetail")
    : viewKey === "backDetail"
    ? t("vBackDetail")
    : viewKey === "pantFrontDetail"
    ? t("vPantFrontDetail")
    : viewKey === "pantBackDetail"
    ? t("vPantBackDetail")
    : viewKey === "pantSideDetail"
    ? t("vPantSideDetail")
    : t("vBackDetail");

                    return (
                      <div key={idx} style={{ display: "grid", gap: 10 }}>
                        {/* Imagen */}
                        <div style={styles.imgCard}>
                          <img src={u} alt={`img-${idx}`} style={{ width: "100%", display: "block" }} />
                        </div>

                        {/* Botones */}
                        <div
                          style={{
                            borderRadius: 14,
                            border: "1px solid rgba(255,255,255,0.12)",
                            background: "rgba(255,255,255,0.06)",
                            padding: 12,
                          }}
                        >
                          <div style={{ fontWeight: 900, marginBottom: 10, color: "rgba(255,255,255,0.9)" }}>
                            {label}
                          </div>

                          <div style={{ display: "grid", gap: 10 }}>
                            <button
                              type="button"
                              onClick={() =>
                                downloadImage(u, `${mode}-${label.replace(/\s+/g, "-").toLowerCase()}.png`)
                              }
                              style={{
                                ...styles.logoutBtnFull,
                                height: 44,
                                background: "#ffffff",
                                border: "1px solid #e2e8f0",
                              }}
                            >
                              {t("download")}
                            </button>

                            <button
                              type="button"
                              onClick={() => handleRegenerateOne(viewKey, idx)}
                              disabled={!!regenLoading[loadKey] || balance < 1}
                              style={{
                                ...styles.buyBtnFull,
                                height: 44,
                                opacity: !!regenLoading[loadKey] || balance < 1 ? 0.6 : 1,
                                cursor: !!regenLoading[loadKey] || balance < 1 ? "not-allowed" : "pointer",
                              }}
                            >
                              {regenLoading[loadKey] === true
  ? t(
      "redoing",
      Math.floor(
        (Date.now() - (regenStartedAt[loadKey] || Date.now())) / 1000
      )
    )
  : balance < 1
  ? t("noCreditsRedo")
  : t("redo")}
                            </button>
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            )}
          </>
        );

      default:
        return null;
    }
  }, [
    steps,
    step,
    mode,
    isMobile,
    // state
    frontFile,
    backFile,
    faceFile,
    faceGenLoading,
    productFiles,
    category,
    otherCategory,
    pockets,
    measures,
    modelType,
    ethnicity,
    ageRange,
    background,
    pose,
    bodyType,
    scene,
    bgSuggestions,
    helpLoading,
    loading,
    result,
    error,
    // deps
    API,
    views,
    selectedCount,
    balance,
  ]);

  // ====== LOGIN ======
  if (!user && !accessToken) {
    return (
      <div style={styles.loginCard}>
        <div style={styles.loginTitle}>{t("signIn")}</div>
        <div style={{ display: "flex", justifyContent: "center", marginTop: 20 }}>
          <div id="googleLoginDiv" />
        </div>
        <div style={styles.loginSub}>{t("signInHint")}</div>
      </div>
    );
  }

  // ====== APP ======
  return (
    <div className={inter.className} style={styles.page}>
      {isRegenBusy && (
        <div
          style={{
            position: "fixed",
            inset: 0,
            background: "rgba(0,0,0,0.55)",
            zIndex: 9999,
            display: "flex",
            alignItems: "center",
            justifyContent: "center",
            padding: 20,
          }}
        >
          <div
            style={{
              width: "100%",
              maxWidth: 420,
              borderRadius: 18,
              background: "#0b1220",
              border: "1px solid rgba(255,255,255,0.15)",
              boxShadow: "0 20px 80px rgba(0,0,0,0.45)",
              padding: 18,
              color: "#fff",
              textAlign: "center",
              fontWeight: 900,
            }}
          >
            {t("regenOverlayTitle")}<br />
            <span style={{ fontWeight: 700, opacity: 0.85, fontSize: 13 }}>{t("regenOverlayHint")}</span>
          </div>
        </div>
      )}
      <div style={styles.shell}>
        {topupStatus === "ok" && (
          <div
            style={{
              background: "#dcfce7",
              border: "1px solid #16a34a",
              color: "#166534",
              padding: "12px",
              borderRadius: "12px",
              marginBottom: "16px",
              fontWeight: 600,
            }}
          >
            {t("topupOk")}
          </div>
        )}

        {topupStatus === "fail" && (
          <div
            style={{
              background: "#fee2e2",
              border: "1px solid #dc2626",
              color: "#7f1d1d",
              padding: "12px",
              borderRadius: "12px",
              marginBottom: "16px",
              fontWeight: 600,
            }}
          >
            {t("topupFail")}
          </div>
        )}

        {/* Header */}
        <div style={{ ...styles.header, flexDirection: "column", alignItems: "stretch", gap: 14 }}>
          {/* WhatsApp (dentro del contenedor, NO sticky) */}
<div
  style={{
    display: "flex",
    justifyContent: "space-between",
    alignItems: "center",
  }}
>
  <a
    href={`https://wa.me/5491125457111?text=${encodeURIComponent(t("whatsappPrefill"))}`}
    target="_blank"
    rel="noopener noreferrer"
    style={styles.whatsappInlineBtn}
    aria-label="WhatsApp AtenciÃ³n al cliente"
  onMouseEnter={(e) => {
  e.currentTarget.style.transform = "translateY(-2px) scale(1.03)";
  e.currentTarget.style.boxShadow =
    "0 16px 40px rgba(37,211,102,0.45), inset 0 1px 0 rgba(255,255,255,0.4)";
}}

onMouseLeave={(e) => {
  e.currentTarget.style.transform = "translateY(0) scale(1)";
  e.currentTarget.style.boxShadow =
    "0 10px 30px rgba(37,211,102,0.35), inset 0 1px 0 rgba(255,255,255,0.35)";
}}
  >
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="20" height="20" fill="#ffffff">
      <path d="M19.11 17.36c-.27-.14-1.59-.78-1.84-.87-.25-.09-.43-.14-.61.14-.18.27-.7.87-.86 1.05-.16.18-.32.2-.59.07-.27-.14-1.13-.42-2.16-1.34-.8-.71-1.34-1.59-1.5-1.86-.16-.27-.02-.42.12-.56.13-.13.27-.32.41-.48.14-.16.18-.27.27-.45.09-.18.05-.34-.02-.48-.07-.14-.61-1.48-.84-2.03-.22-.53-.45-.46-.61-.47h-.52c-.18 0-.48.07-.73.34-.25.27-.96.94-.96 2.29 0 1.34.98 2.64 1.12 2.82.14.18 1.93 2.95 4.67 4.13.65.28 1.16.45 1.56.58.66.21 1.26.18 1.73.11.53-.08 1.59-.65 1.82-1.28.23-.63.23-1.17.16-1.28-.07-.11-.25-.18-.52-.32z"/>
      <path d="M16.02 3C8.83 3 3 8.83 3 16.02c0 2.82.9 5.44 2.43 7.58L3 29l5.53-2.4c2.06 1.12 4.41 1.76 6.97 1.76C23.17 28.36 29 22.53 29 15.34 29 8.83 23.17 3 16.02 3zm0 23.36c-2.36 0-4.54-.7-6.38-1.91l-.46-.3-3.28 1.42 1.43-3.2-.3-.48c-1.32-2.05-2.01-4.43-2.01-6.87 0-6.12 4.98-11.1 11.1-11.1 6.12 0 11.1 4.98 11.1 11.1 0 6.12-4.98 11.1-11.1 11.1z"/>
    </svg>
    <span style={{ fontWeight: 900, fontSize: 12 }}>
  {t("whatsapp")}
</span>
  </a>
</div>
          <div>
            <div style={{ display: "flex", alignItems: "center", gap: 12 }}>
  <img
    src="/logo.png"
    alt="Logo"
    style={{
      height: 36,
      width: "auto",
      display: "block",
    }}
  />
  <div style={{ ...styles.h1, color: "#9495B5" }}>
    {t("title")}
  </div>
</div>

            <div
              style={{
                marginTop: 16,
                position: "relative",
                width: 360,
                maxWidth: "100%",
                height: 52,
                borderRadius: 999,
                padding: 6,
                background: "linear-gradient(90deg,#7c3aed,#9333ea,#a855f7)",
                boxShadow: "0 12px 30px rgba(124,58,237,0.35)",
                overflow: "hidden",
                display: "flex",
              }}
            >
              <div
                style={{
                  position: "absolute",
                  top: 6,
                  left: mode === "model" ? 6 : "calc(50% + 0px)",
                  width: "calc(50% - 6px)",
                  height: 40,
                  borderRadius: 999,
                  background: "#ffffff",
                  transition: "left 0.25s ease",
                  boxShadow: "0 6px 18px rgba(0,0,0,0.15)",
                }}
              />

              <button
                type="button"
                onClick={() => setMode("model")}
                style={{
                  position: "relative",
                  zIndex: 2,
                  flex: 1,
                  height: 40,
                  borderRadius: 999,
                  border: "none",
                  background: "transparent",
                  cursor: "pointer",
                  fontWeight: 900,
                  fontSize: 14,
                  color: mode === "model" ? "#7c3aed" : "#ffffff",
                  transition: "color 0.25s ease",
                  whiteSpace: "nowrap",
                }}
              >
                {t("modeModel")}
              </button>

              <button
                type="button"
                onClick={() => setMode("product")}
                style={{
                  position: "relative",
                  zIndex: 2,
                  flex: 1,
                  height: 40,
                  borderRadius: 999,
                  border: "none",
                  background: "transparent",
                  cursor: "pointer",
                  fontWeight: 900,
                  fontSize: 14,
                  color: mode === "product" ? "#7c3aed" : "#ffffff",
                  transition: "color 0.25s ease",
                  whiteSpace: "nowrap",
                }}
              >
                {t("modeProduct")}
              </button>
            </div>

            <div style={{ ...styles.h2, color: "#cbd5e1" }}>{t("subtitle")}</div>
          </div>

          <div style={{ marginTop: 10 }}>
            <select
              value={language}
              onChange={(e) => setLanguage(e.target.value as any)}
              style={{
                padding: "8px 10px",
                borderRadius: 10,
                border: "1px solid #e2e8f0",
                background: "#ffffff",
                color: "#000000",
                fontWeight: 700,
                cursor: "pointer",
                width: isMobile ? "100%" : 140,
                boxSizing: "border-box",
              }}
            >
              <option value="es">ðŸ‡ªðŸ‡¸ ES</option>
              <option value="en">ðŸ‡ºðŸ‡¸ EN</option>
              <option value="pt">ðŸ‡§ðŸ‡· PT</option>
              <option value="ko">ðŸ‡°ðŸ‡· KO</option>
              <option value="zh">ðŸ‡¨ðŸ‡³ ä¸­æ–‡</option>
            </select>
          </div>
        </div>

        {/* User card (NO overflow) */}
        <div style={styles.userCard}>
          <div style={styles.userEmail}>{user?.email || user?.name}</div>
              {(() => {
  void bonusTick;

  const paid = user?.wallet?.paidBalance ?? 0;
  const hasBonus = balance > paid;

  const expIso = user?.wallet?.welcomeExpiresAt;
  const expMs = expIso ? new Date(expIso).getTime() : null;

  const diffMs = expMs ? expMs - Date.now() : 0;
const totalSec = Math.max(0, Math.floor(diffMs / 1000));

const hours = Math.floor(totalSec / 3600);
const minutes = Math.floor((totalSec % 3600) / 60);
const seconds = totalSec % 60;

const hh = String(hours).padStart(2, "0");
const mm = String(minutes).padStart(2, "0");
const ss = String(seconds).padStart(2, "0");

  if (!hasBonus || !expMs || totalSec <= 0) return null;

  return (
    <div
      style={{
        marginTop: 6,
        padding: "6px 10px",
        borderRadius: 999,
        background: "#fff7ed",
        border: "1px solid #fdba74",
        color: "#9a3412",
        fontSize: 12,
        fontWeight: 800,
        display: "inline-block",
      }}
    >
      {t("bonusExpiresIn", hh, mm, ss)}
    </div>
  );
})()}
          <div style={{ width: "100%", maxWidth: "100%", overflow: "hidden" }}>
            <div style={styles.badgeClamp}>
  {loadingMe ? t("loading") : `${t("credits")}: ${balance}`}
</div>
          </div>

          <div style={styles.packCard}>
            <select value={selectedPack} onChange={(e) => setSelectedPack(e.target.value as any)} 
            style={styles.packSelect}>
                <option value="emprendedor">{t("packEntrepreneur")}</option>
                <option value="pyme">{t("packPyme")}</option>
                <option value="empresa">{t("packEnterprise")}</option>
            </select>

            <button
              type="button"
              disabled={buyLoading}
              onClick={async () => {
                try {
                  setBuyLoading(true);
                  const token = localStorage.getItem("accessToken");
                  const credits = selectedPack === "emprendedor" ? 50 : selectedPack === "pyme" ? 100 : 200;

                  const res = await fetch(`${API}/mp/create-preference`, {
                    method: "POST",
                    headers: {
                      "Content-Type": "application/json",
                      Authorization: `Bearer ${token}`,
                    },
                    body: JSON.stringify({ credits }),
                  });

                  const data = await res.json();
                  if (!res.ok) throw new Error(data?.error || "Error creando preferencia");
                  if (!data?.init_point) throw new Error("No init_point recibido");

                  window.location.href = data.init_point;
                } catch (e: any) {
                  alert(String(e?.message || e));
                } finally {
                  setBuyLoading(false);
                }
              }}
              style={styles.buyBtnFull}
            >
              {buyLoading ? t("processing") : `ðŸ’³ ${t("buyCredits")}`}
            </button>

            <button type="button" onClick={handleLogout} style={styles.logoutBtnFull}>
              ðŸšª {t("logout")}
            </button>
          </div>
        </div>

        {/* Historial */}
        <details
          style={{
            marginTop: 20,
            marginBottom: 20,
            border: "1px solid #e5e7eb",
            borderRadius: 16,
            background: "#ffffff",
            boxShadow: "0 1px 0 rgba(15,23,42,0.03)",
          }}
        >
          <summary
            style={{
              cursor: "pointer",
              listStyle: "none",
              padding: "14px 16px",
              display: "flex",
              alignItems: "center",
              justifyContent: "space-between",
              fontWeight: 800,
            }}
          >
            <span style={{ color: "#1e293b", fontWeight: 800 }}>ðŸ“’ {t("history")}</span>
          </summary>

          <div style={{ padding: "0 16px 16px 16px" }}>
            {loadingEntries ? (
              <div style={{ color: "#64748b", paddingTop: 8 }}>{t("loading")}</div>
            ) : entries.length === 0 ? (
              <div style={{ color: "#64748b", paddingTop: 8 }}>{t("noMovements")}</div>
            ) : (
              <div
                style={{
                  marginTop: 8,
                  overflowX: "hidden",
                  border: "1px solid #e5e7eb",
                  borderRadius: 12,
                  width: "100%",
                  maxWidth: "100%",
                }}
              >
                <table style={{ width: "100%", tableLayout: "fixed", borderCollapse: "collapse", fontSize: 13 }}>
                  <thead>
                    <tr style={{ textAlign: "left", background: "#f8fafc", borderBottom: "1px solid #e5e7eb" }}>
                      <th style={{ padding: "10px 14px", color: "#475569", width: "40%" }}>{t("date")}</th>
                      <th style={{ padding: "10px 14px", color: "#475569", width: "35%" }}>{t("movement")}</th>
                      <th style={{ padding: "10px 14px", textAlign: "right", color: "#475569", width: "25%" }}>
                        {t("amount")}
                      </th>
                    </tr>
                  </thead>

                  <tbody>
  {entries
    .slice((entriesPage - 1) * ENTRIES_PAGE_SIZE, entriesPage * ENTRIES_PAGE_SIZE)
    .map((e) => {
                      const isPlus = e.amount > 0;

const consumeMode = (e as any)?.metadata?.mode; // "model" | "product" | undefined
const consumeLabel =
  consumeMode === "model"
    ? t("consumeModel")
    : consumeMode === "product"
    ? t("consumeProduct")
    : t("consumeGeneric");
console.log("ENTRY:", e);
const label =
  e.refType === "WELCOME_BONUS_EXPIRE"
    ? t("expired")
    : e.type === "PURCHASE"
    ? t("purchase")
    : e.type === "CONSUME"
    ? consumeLabel
    : e.type === "REFUND"
    ? t("refund")
    : e.type === "GRANT"
    ? t("grant")
    : e.type;

                      return (
                        <tr key={e.id} style={{ borderBottom: "1px solid #f1f5f9" }}>
                          <td
                            style={{
                              padding: "10px 10px",
                              color: "#0f172a",
                              whiteSpace: "normal",
                              overflow: "hidden",
                              textOverflow: "ellipsis",
                              wordBreak: "break-word",
                            }}
                          >
                            {new Date(e.createdAt).toLocaleString()}
                          </td>

                          <td style={{ padding: "10px 10px" }}>
                            <span
                              style={{
                                display: "inline-block",
                                fontWeight: 800,
                                fontSize: 12,
                                padding: "4px 10px",
                                borderRadius: 999,
                                border: "1px solid #e2e8f0",
                                background: "#ffffff",
                                color: "#0f172a",
                              }}
                            >
                              {label}
                            </span>
                          </td>

                          <td
                            style={{
                              padding: "10px 14px",
                              textAlign: "right",
                              fontWeight: 900,
                              color: isPlus ? "#16a34a" : "#dc2626",
                              whiteSpace: "nowrap",
                            }}
                          >
                            {isPlus ? `+${e.amount}` : e.amount}
                          </td>
                        </tr>
                      );
                    })}
                  </tbody>
                </table>
                {(() => {
  const totalPages = Math.max(1, Math.ceil(entries.length / ENTRIES_PAGE_SIZE));
  if (totalPages <= 1) return null;

  return (
    <div style={{ display: "flex", gap: 10, alignItems: "center", justifyContent: "flex-end", padding: 10 }}>
      <button
        type="button"
        onClick={() => setEntriesPage((p) => Math.max(1, p - 1))}
        disabled={entriesPage <= 1}
        style={{
  ...styles.pagerBtn,
  opacity: entriesPage <= 1 ? 0.5 : 1,
  cursor: entriesPage <= 1 ? "not-allowed" : "pointer",
}}
      >
        {t("previous")}
      </button>

      <div style={{ fontSize: 12, fontWeight: 900, color: "#0f172a" }}>
        {t("pageXofY", entriesPage, totalPages)}
      </div>

      <button
        type="button"
        onClick={() => setEntriesPage((p) => Math.min(totalPages, p + 1))}
        disabled={entriesPage >= totalPages}
        style={{
  ...styles.pagerBtn,
  background: "linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",
  color: "#ffffff",
  border: "none",
  opacity: entriesPage >= totalPages ? 0.5 : 1,
  cursor: entriesPage >= totalPages ? "not-allowed" : "pointer",
}}
      >
        {t("following")}
      </button>
    </div>
  );
})()}
              </div>
            )}
          </div>
        </details>

        {/* Main */}
        <div style={isMobile ? styles.mainMobile : styles.main}>
          {/* Steps (mobile dropdown) */}
          <div style={{ marginBottom: 16 }}>
            <button
              type="button"
              onClick={() => setMobileStepsOpen((v) => !v)}
              style={{
                width: "100%",
                padding: "10px 14px",
                borderRadius: 14,
                background: "rgba(255,255,255,0.08)",
                border: "1px solid rgba(255,255,255,0.15)",
                color: "#ffffff",
                display: "flex",
                alignItems: "center",
                justifyContent: "space-between",
                fontSize: 12,
                fontWeight: 800,
                cursor: "pointer",
                boxSizing: "border-box",
              }}
            >
              <span>
                {t("stepOf", step + 1, steps.length)}
              </span>
              <span style={{ opacity: 0.9 }}>{mobileStepsOpen ? "â–²" : "â–¼"}</span>
            </button>

            <div style={{ marginTop: 10, height: 6, borderRadius: 999, background: "rgba(255,255,255,0.2)", overflow: "hidden" }}>
              <div
                style={{
                  width: `${((step + 1) / steps.length) * 100}%`,
                  height: "100%",
                  background: "linear-gradient(90deg,#6366f1,#22d3ee)",
                  transition: "width 0.25s ease",
                }}
              />
            </div>

            {mobileStepsOpen && (
              <div
                style={{
                  marginTop: 12,
                  borderRadius: 14,
                  background: "rgba(255,255,255,0.08)",
                  border: "1px solid rgba(255,255,255,0.15)",
                  overflow: "hidden",
                }}
              >
                {steps.map((s, i) => {
                  const active = i === step;
                  const done = i < step;

                  return (
                    <button
                      key={s.key}
                      type="button"
                      onClick={() => {
                        setStep(i);
                        setMobileStepsOpen(false);
                      }}
                      style={{
                        width: "100%",
                        display: "flex",
                        alignItems: "center",
                        justifyContent: "space-between",
                        padding: "12px 14px",
                        border: "none",
                        background: active ? "rgba(255,255,255,0.10)" : "transparent",
                        color: "#ffffff",
                        cursor: "pointer",
                        textAlign: "left",
                        fontWeight: active ? 900 : 700,
                      }}
                    >
                      <span style={{ display: "flex", alignItems: "center", gap: 10 }}>
                        <span
                          style={{
                            width: 22,
                            height: 22,
                            borderRadius: 999,
                            display: "flex",
                            alignItems: "center",
                            justifyContent: "center",
                            fontSize: 12,
                            fontWeight: 900,
                            background: done
                              ? "rgba(34,197,94,0.9)"
                              : active
                              ? "rgba(99,102,241,0.9)"
                              : "rgba(255,255,255,0.18)",
                            color: "#0f172a",
                          }}
                        >
                          {done ? "âœ“" : i + 1}
                        </span>
                        <span>{s.title}</span>
                      </span>

                      <span style={{ opacity: 0.7 }}>{active ? "â—" : ""}</span>
                    </button>
                  );
                })}
              </div>
            )}
          </div>

          {/* Panel */}
          <section style={styles.panel}>
            {stepError && <div style={styles.inlineWarn}>{stepError}</div>}
            {error && <div style={styles.inlineErr}>{error}</div>}

            {panel}

            <div style={styles.footer}>
              <Button variant="secondary" onClick={prev} disabled={isRegenBusy || step === 0 || loading}>
                {t("back")}
              </Button>

              <div style={{ flex: 1 }} />

              {!isLast ? (
                <Button onClick={next} disabled={isRegenBusy || !canGoNext}>
                  {t("next")}
                </Button>
              ) : null}
            </div>
          </section>
        </div>
      </div>
    </div>
  );
}

/* ================== UI COMPONENTS ================== */

function FieldTitle({ children }: { children: React.ReactNode }) {
  return <div style={styles.fieldTitle}>{children}</div>;
}

function Label({ children, style }: { children: React.ReactNode; style?: React.CSSProperties }) {
  return <div style={{ ...styles.label, ...(style || {}) }}>{children}</div>;
}

function SmallMuted({ children, style }: { children: React.ReactNode; style?: React.CSSProperties }) {
  return <div style={{ ...styles.smallMuted, ...(style || {}) }}>{children}</div>;
}

function Row({ children, style }: { children: React.ReactNode; style?: React.CSSProperties }) {
  return <div style={{ ...styles.row, ...(style || {}) }}>{children}</div>;
}

function TwoCols({ children }: { children: React.ReactNode }) {
  return <div style={styles.twoCols}>{children}</div>;
}

function Grid3({ children }: { children: React.ReactNode }) {
  return <div style={styles.grid3}>{children}</div>;
}

function Box({ children }: { children: React.ReactNode }) {
  return <div style={styles.box}>{children}</div>;
}

function TextInput({
  value,
  onChange,
  placeholder,
}: {
  value: string;
  onChange: (v: string) => void;
  placeholder?: string;
}) {
  const [focused, setFocused] = useState(false);

  return (
    <input
      value={value}
      placeholder={placeholder}
      onChange={(e) => onChange(e.target.value)}
      onFocus={() => setFocused(true)}
      onBlur={() => setFocused(false)}
      style={{
        ...styles.input,
        border: focused ? "1px solid #6366f1" : "1px solid rgba(255,255,255,0.15)",
        boxShadow: focused ? "0 0 0 3px rgba(99,102,241,0.25)" : "none",
      }}
    />
  );
}

function InputFile({ onChange, isMobile }: { onChange: (f: File | null) => void; isMobile?: boolean }) {
  return (
    <input
      type="file"
      accept="image/*"
      {...(isMobile ? ({ capture: "environment" } as any) : {})}
      onChange={(e) => onChange(e.target.files?.[0] || null)}
      style={styles.file}
    />
  );
}

function InputFiles({ onChange }: { onChange: (files: File[]) => void }) {
  return (
    <input
      type="file"
      accept="image/*"
      multiple
      onChange={(e) => onChange(Array.from(e.target.files || []))}
      style={styles.file}
    />
  );
}

function RadioPills({
  value,
  onChange,
  options,
}: {
  value: string;
  onChange: (v: string) => void;
  options: Array<{ value: string; label: string }>;
}) {
  return (
    <div style={styles.pills}>
      {options.map((o) => {
        const active = value === o.value;
        return (
          <button
  key={typeof o.value === "string" ? o.value : JSON.stringify(o.value)}
  onClick={() => onChange(String(o.value))}
  style={{ ...styles.pill, ...(active ? styles.pillActive : {}) }}
>
  {o.label}
</button>
        );
      })}
    </div>
  );
}

function Button({
  children,
  onClick,
  disabled,
  variant = "primary",
  style,
}: {
  children: React.ReactNode;
  onClick?: () => void;
  disabled?: boolean;
  variant?: "primary" | "secondary";
  style?: React.CSSProperties;
}) {
  const base = variant === "primary" ? styles.btnPrimary : styles.btnSecondary;
  const dis = disabled ? styles.btnDisabled : {};
  return (
    <button onClick={onClick} disabled={disabled} style={{ ...base, ...dis, ...(style || {}) }}>
      {children}
    </button>
  );
}

function SummaryItem({ label, value }: { label: string; value: string }) {
  return (
    <div style={styles.summaryItem}>
      <div style={styles.summaryLabel}>{label}</div>
      <div style={styles.summaryValue}>{value || "â€”"}</div>
    </div>
  );
}

function ModelSummary({
  t,
  category,
  otherCategory,
  pockets,
  modelType,
  ethnicity,
  ageRange,
  background,
  pose,
  bodyType,
  labelFromList,
  CATEGORIES,
  MODEL_TYPES,
  ETHNICITIES,
  POSES,
  BODY_TYPES,
  styles,
}: any) {
  return (
    <div style={styles.summaryGrid}>
      <SummaryItem
        label={t("stepCategory")}
        value={
          category === "other"
            ? `${t("catOther")}: ${otherCategory}`
            : labelFromList(CATEGORIES, category)
        }
      />

      <SummaryItem
        label={t("stepPockets")}
        value={pockets ? (pockets === "si" ? t("yes") : t("no")) : ""}
      />

      <SummaryItem label={t("stepModel")} value={labelFromList(MODEL_TYPES, modelType)} />

      <SummaryItem label={t("stepEthnicity")} value={labelFromList(ETHNICITIES, ethnicity)} />

      <SummaryItem label={t("stepAge")} value={ageRange ? t(ageRange) : ""} />

      <SummaryItem label={t("stepBackground")} value={background} />

      <SummaryItem label={t("stepPose")} value={labelFromList(POSES, pose)} />

      <SummaryItem label={t("stepBodyType")} value={labelFromList(BODY_TYPES, bodyType)} />
    </div>
  );
}

/* ================== STYLES ================== */

const styles: Record<string, React.CSSProperties> = {
  page: {
    minHeight: "100vh",
    padding: 20,
    background:
      'radial-gradient(circle at 20% 20%, rgba(59,130,246,0.15), transparent 40%), radial-gradient(circle at 80% 0%, rgba(168,85,247,0.15), transparent 40%), linear-gradient(135deg, #0f172a 0%, #111827 100%)',
    display: "flex",
    justifyContent: "center",
    alignItems: "flex-start",
    color: "#ffffff",
    overflowX: "hidden",
    boxSizing: "border-box",
  },
  shell: { width: "100%", maxWidth: 1100, margin: "0 auto" },
  header: {
    display: "flex",
    alignItems: "flex-start",
    justifyContent: "flex-start",
    padding: "18px 24px",
    borderRadius: 20,
    background: "rgba(255,255,255,0.06)",
    backdropFilter: "blur(14px)",
    WebkitBackdropFilter: "blur(14px)",
    border: "1px solid rgba(255,255,255,0.1)",
    boxShadow: "0 10px 40px rgba(0,0,0,0.35)",
    marginBottom: 30,
    boxSizing: "border-box",
    width: "100%",
    overflow: "hidden",
  },
  h1: { fontSize: 28, fontWeight: 800, letterSpacing: -0.2 },
  h2: { marginTop: 6, color: "#475569" },

  userCard: {
    width: "100%",
    maxWidth: "100%",
    padding: "14px 16px",
    borderRadius: 18,
    background: "linear-gradient(145deg, #ffffff, #f1f5f9)",
    boxShadow: "0 10px 30px rgba(0,0,0,0.15)",
    color: "#0f172a",
    display: "grid",
    gridTemplateColumns: "1fr",
    gap: 12,
    alignItems: "stretch",
    overflow: "hidden",
    boxSizing: "border-box",
    marginBottom: 24,
  },
  userEmail: {
    fontSize: 12,
    color: "#0f172a",
    fontWeight: 900,
    minWidth: 0,
    overflow: "hidden",
    textOverflow: "ellipsis",
    whiteSpace: "nowrap",
  },
  badge: {
    background: "#eff6ff",
    color: "#1d4ed8",
    borderWidth: 1,
    borderStyle: "solid",
    borderColor: "#bfdbfe",
    padding: "6px 10px",
    borderRadius: 999,
    fontWeight: 700,
    fontSize: 12,
  },
  badgeClamp: {
    background: "#eff6ff",
    color: "#1d4ed8",
    borderWidth: 1,
    borderStyle: "solid",
    borderColor: "#bfdbfe",
    padding: "6px 10px",
    borderRadius: 999,
    fontWeight: 700,
    fontSize: 12,
    display: "inline-flex",
    alignItems: "center",
    maxWidth: "100%",
    boxSizing: "border-box",
    overflow: "hidden",
    textOverflow: "ellipsis",
    whiteSpace: "nowrap",
  },
  packCard: {
    width: "100%",
    maxWidth: "100%",
    display: "grid",
    gridTemplateColumns: "1fr",
    gap: 10,
    padding: 10,
    borderRadius: 16,
    background: "#ffffff",
    border: "1px solid #e2e8f0",
    boxShadow: "0 6px 16px rgba(0,0,0,0.08)",
    alignItems: "stretch",
    overflow: "hidden",
    boxSizing: "border-box",
  },
  packSelect: {
    height: 40,
    padding: "6px 10px",
    borderRadius: 12,
    border: "1px solid #cbd5e1",
    background: "#ffffff",
    color: "#0f172a",
    fontWeight: 900,
    width: "100%",
    maxWidth: "100%",
    minWidth: 0,
    boxSizing: "border-box",
    display: "block",
    overflow: "hidden",
    textOverflow: "ellipsis",
    whiteSpace: "nowrap",
  },
  buyBtnFull: {
    background: "linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",
    color: "#ffffff",
    border: "none",
    height: 40,
    padding: "0 16px",
    borderRadius: 14,
    fontWeight: 900,
    cursor: "pointer",
    boxShadow: "0 8px 20px rgba(99,102,241,0.35)",
    transition: "all 0.2s ease",
    width: "100%",
    maxWidth: "100%",
    boxSizing: "border-box",
    display: "block",
  },
  logoutBtnFull: {
    background: "transparent",
    color: "#0f172a",
    border: "1px solid #e2e8f0",
    height: 40,
    padding: "0 14px",
    borderRadius: 14,
    fontWeight: 900,
    cursor: "pointer",
    transition: "all 0.2s ease",
    width: "100%",
    maxWidth: "100%",
    boxSizing: "border-box",
    display: "flex",
    alignItems: "center",
    justifyContent: "center",
  },

  main: { display: "grid", gridTemplateColumns: "280px 1fr", gap: 16, alignItems: "start" },
  mainMobile: { display: "grid", gridTemplateColumns: "1fr", gap: 16, alignItems: "start" },

  panel: {
    borderRadius: 24,
    padding: 28,
    paddingBottom: 36,
    background: "rgba(255,255,255,0.06)",
    backdropFilter: "blur(16px)",
    WebkitBackdropFilter: "blur(16px)",
    border: "1px solid rgba(255,255,255,0.12)",
    boxShadow: "0 20px 60px rgba(0,0,0,0.35)",
    width: "100%",
    boxSizing: "border-box",
    overflow: "hidden",
  },

  inlineWarn: {
    background: "#fffbeb",
    border: "1px solid #fde68a",
    color: "#92400e",
    padding: "10px 12px",
    borderRadius: 12,
    marginBottom: 12,
    fontWeight: 700,
  },
  inlineErr: {
    background: "#fef2f2",
    border: "1px solid #fecaca",
    color: "#991b1b",
    padding: "10px 12px",
    borderRadius: 12,
    marginBottom: 12,
    fontWeight: 700,
  },

  footer: {
    display: "flex",
    gap: 10,
    marginTop: 18,
    paddingTop: 14,
    borderTop: "1px solid rgba(255,255,255,0.15)",
  },

  fieldTitle: { fontSize: 18, fontWeight: 900, marginBottom: 12 },
  label: { fontSize: 13, fontWeight: 700, marginBottom: 6, color: "#cbd5e1", letterSpacing: 0.3 },
  smallMuted: { fontSize: 12, color: "#94a3b8", marginTop: 6 },
  row: { display: "flex", alignItems: "center", gap: 10 },
  twoCols: { display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(240px, 1fr))", gap: 12 },
  grid3: { display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(180px, 1fr))", gap: 10 },

  box: { border: "1px solid #e5e7eb", borderRadius: 14, padding: 12, background: "#f8fafc" },

  input: {
    width: "100%",
    padding: "12px 14px",
    borderRadius: 14,
    border: "1px solid rgba(255,255,255,0.15)",
    background: "rgba(255,255,255,0.06)",
    color: "#ffffff",
    outline: "none",
    fontSize: 14,
    backdropFilter: "blur(6px)",
    transition: "all 0.25s ease",
    boxSizing: "border-box",
  },

  file: {
    width: "100%",
    padding: "10px 12px",
    borderRadius: 12,
    border: "1px dashed #cbd5e1",
    background: "#ffffff",
    color: "#0f172a",
    boxSizing: "border-box",
  },

  pills: { display: "flex", gap: 10, flexWrap: "wrap" as any },
  pill: {
    padding: "10px 14px",
    borderRadius: 999,
    border: "1px solid #d1d5db",
    background: "#ffffff",
    cursor: "pointer",
    fontWeight: 800,
    color: "#0f172a",
  },
  pillsGrid2: { display: "grid", gridTemplateColumns: "repeat(2, 1fr)", gap: 10 },
  pillMobile: { width: "100%", justifyContent: "center" },
  pillsGrid2Mobile: { display: "grid", gridTemplateColumns: "1fr", gap: 10 },
  pillActive: { background: "#2563eb", border: "1px solid #2563eb", color: "#ffffff" },

  btnPrimary: {
    background: "linear-gradient(135deg, #3b82f6 0%, #22c55e 100%)",
    color: "#ffffff",
    border: "1px solid rgba(255,255,255,0.12)",
    padding: "10px 14px",
    borderRadius: 14,
    fontWeight: 900,
    cursor: "pointer",
    boxShadow: "0 10px 28px rgba(59,130,246,0.25)",
  },
  btnSecondary: {
    background: "rgba(255,255,255,0.08)",
    color: "#ffffff",
    border: "1px solid rgba(255,255,255,0.14)",
    padding: "10px 14px",
    borderRadius: 14,
    fontWeight: 900,
    cursor: "pointer",
    backdropFilter: "blur(10px)",
    WebkitBackdropFilter: "blur(10px)",
  },
  btnDisabled: { opacity: 0.6, cursor: "not-allowed" },

  suggestionBtn: {
    width: "100%",
    textAlign: "left",
    padding: "10px 12px",
    borderRadius: 12,
    border: "1px solid #e5e7eb",
    background: "#f8fafc",
    cursor: "pointer",
    fontWeight: 700,
    color: "#0f172a",
    boxSizing: "border-box",
  },

  summaryCard: {
    border: "1px solid #e5e7eb",
    borderRadius: 14,
    padding: 14,
    background: "#f8fafc",
    marginBottom: 22,
  },
  summaryTitle: { fontWeight: 900, marginBottom: 10 },
  summaryGrid: { display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(220px, 1fr))", gap: 10 },
  summaryItem: { border: "1px solid #e5e7eb", borderRadius: 12, padding: 10, background: "#ffffff" },
  summaryLabel: { fontSize: 12, color: "#64748b", fontWeight: 800 },
  summaryValue: { fontSize: 13, color: "#0f172a", fontWeight: 900, marginTop: 4 },

  resultGrid: { display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(220px, 1fr))", gap: 12 },
  imgCard: { border: "1px solid #e5e7eb", borderRadius: 14, overflow: "hidden", background: "#ffffff" },

 whatsappInlineBtn: {
  position: "relative",
  display: "inline-flex",
  alignItems: "center",
  gap: 10,
  padding: "10px 16px",
  borderRadius: 999,

  // Glass premium
  background: "linear-gradient(135deg, rgba(37,211,102,0.95) 0%, rgba(22,163,74,0.95) 100%)",
  backdropFilter: "blur(10px)",
  WebkitBackdropFilter: "blur(10px)",

  color: "#ffffff",
  textDecoration: "none",
  border: "1px solid rgba(255,255,255,0.28)",

  // Glow elegante (no exagerado)
  boxShadow: `
    0 10px 30px rgba(37,211,102,0.35),
    inset 0 1px 0 rgba(255,255,255,0.35)
  `,

  fontWeight: 900,
  fontSize: 13,
  letterSpacing: 0.3,

  transition: "all 0.25s cubic-bezier(.4,0,.2,1)",
  transform: "translateY(0)",
  userSelect: "none",
},
  loginCard: {
    maxWidth: 420,
    margin: "80px auto",
    padding: 40,
    borderRadius: 20,
    border: "1px solid #e5e7eb",
    background: "#ffffff",
    boxShadow: "0 10px 30px rgba(0,0,0,0.05)",
    textAlign: "center",
    color: "#0f172a",
  },
  loginTitle: { fontSize: 24, fontWeight: 800, color: "#0f172a" },
  loginSub: { marginTop: 16, fontSize: 13, color: "#64748b" },

  previewGrid: { 
    display: "grid", 
    gridTemplateColumns: "repeat(auto-fit, minmax(160px, 1fr))", 
    gap: 10,
  },
  previewCard: {
    borderRadius: 14,
    overflow: "hidden",
    border: "1px solid rgba(255,255,255,0.12)",
    background: "rgba(255,255,255,0.06)",
    padding: 8,
  },
  previewImg: {
    width: "100%",
    height: 180,
    objectFit: "contain",
    display: "block",
    background: "rgba(255,255,255,0.06)",
  },
  previewGridCompact: {
  display: "grid",
  gridTemplateColumns: "repeat(auto-fill, minmax(160px, 160px))",
  gap: 10,
  justifyContent: "center",
},

previewImgCompact: {
  width: "100%",
  height: 160,
  objectFit: "cover",
  display: "block",
  borderRadius: 12,
  background: "rgba(255,255,255,0.06)",
},
  pagerBtn: {
  height: 34,
  padding: "0 12px",
  borderRadius: 10,
  fontWeight: 900,
  fontSize: 12,
  cursor: "pointer",
  border: "1px solid #e2e8f0",
  background: "#ffffff",
  color: "#0f172a",
  boxShadow: "0 6px 16px rgba(15,23,42,0.06)",
},

pagerBtnPrimary: {
  height: 34,
  padding: "0 12px",
  borderRadius: 10,
  fontWeight: 900,
  fontSize: 12,
  cursor: "pointer",
  border: "none",
  color: "#ffffff",
  background: "linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",
  boxShadow: "0 10px 22px rgba(99,102,241,0.28)",
},

};
